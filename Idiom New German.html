<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Redewendungs-Insel Abenteuer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&family=Inter:wght@400;500;600,700&display=swap');
    .game-font { font-family: 'Fredoka One', cursive; }
    .body-font { font-family: 'Inter', sans-serif; }
    .island-bg { background: linear-gradient(135deg,#667eea 0%,#764ba2 100%); min-height:100vh; }
    .zone-card { transition:all .3s ease; }
    .zone-card:hover { transform: translateY(-5px); box-shadow:0 20px 40px rgba(0,0,0,.1); }
    .zone-locked { opacity:.6; filter:grayscale(100%); }
    .progress-bar { transition:width .5s ease; }
    .drag-item { cursor:grab; }
    .drop-zone { min-height:60px; transition:all .2s ease; }
    .drop-zone.drag-over { background-color:#e0f2fe; border-color:#0284c7; }
    .correct-match { background-color:#dcfce7!important; border-color:#16a34a!important; }
    .wrong-match   { background-color:#fef2f2!important; border-color:#dc2626!important; }
    @keyframes bounce { 0%,20%,50%,80%,100%{transform:translateY(0);}40%{transform:translateY(-10px);}60%{transform:translateY(-5px);} }
    .bounce-animation { animation:bounce .6s; }
    .timer-warning { animation:pulse 1s infinite; }
    @keyframes pulse { 0%{opacity:1;}50%{opacity:.5;}100%{opacity:1;} }
  </style>
</head>
<body class="island-bg body-font">

  <div id="app" class="min-h-screen">

    <div id="mainMenu" class="container mx-auto px-4 py-8">
      <div class="text-center mb-12">
        <h1 class="game-font text-6xl text-white mb-4">🏝️ Redewendungs-Insel</h1>
        <p class="text-xl text-blue-100 mb-8">
          Meistere 100 deutsche Redewendungen durch spannende Herausforderungen!
        </p>
        <div class="bg-white/20 backdrop-blur-sm rounded-2xl p-6 max-w-md mx-auto mb-8">
          <div class="flex justify-between items-center mb-4">
            <span class="text-white font-semibold">Gesamtpunktzahl:</span>
            <span id="totalScore" class="text-2xl font-bold text-yellow-300">0</span>
          </div>
          <div class="w-full bg-white/20 rounded-full h-3">
            <div id="overallProgress"
                 class="progress-bar bg-gradient-to-r from-yellow-400 to-orange-500 h-3 rounded-full"
                 style="width:0%"></div>
          </div>
          <p class="text-blue-100 text-sm mt-2">Fortschritt zum Redewendungs-Meister</p>
        </div>
      </div>
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-6xl mx-auto">
        <div class="zone-card bg-white rounded-2xl p-6 shadow-xl" data-zone="1">
          <div class="text-center">
            <div class="text-4xl mb-4">🌟</div>
            <h3 class="game-font text-2xl text-blue-600 mb-2">Bucht der Paare</h3>
            <p class="text-gray-600 mb-4">Redewendung ↔ Bedeutung</p>
            <div class="flex justify-between text-sm text-gray-500 mb-4">
              <span>Max: 100 P</span>
              <span id="zone1Score">P: 0</span>
            </div>
            <button onclick="startZone(1)"
                    class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-full">
              Abenteuer starten
            </button>
          </div>
        </div>
        <div class="zone-card bg-white rounded-2xl p-6 shadow-xl zone-locked" data-zone="2">
          <div class="text-center">
            <div class="text-4xl mb-4">❓</div>
            <h3 class="game-font text-2xl text-gray-400 mb-2">Klippe Wahr/Falsch</h3>
            <p class="text-gray-400 mb-4">Wahr-oder-Falsch Fragen</p>
            <div class="flex justify-between text-sm text-gray-400 mb-4">
              <span>Max: 100 P</span>
              <span id="zone2Score">P: 0</span>
            </div>
            <button class="bg-gray-300 text-gray-500 px-6 py-2 rounded-full cursor-not-allowed">
              🔒 Gesperrt
            </button>
          </div>
        </div>
        <div class="zone-card bg-white rounded-2xl p-6 shadow-xl zone-locked" data-zone="3">
          <div class="text-center">
            <div class="text-4xl mb-4">✍️</div>
            <h3 class="game-font text-2xl text-gray-400 mb-2">Verborgener Schatz</h3>
            <p class="text-gray-400 mb-4">Lückentexte</p>
            <div class="flex justify-between text-sm text-gray-400 mb-4">
              <span>Max: 150 P</span>
              <span id="zone3Score">P: 0</span>
            </div>
            <button class="bg-gray-300 text-gray-500 px-6 py-2 rounded-full cursor-not-allowed">
              🔒 Gesperrt
            </button>
          </div>
        </div>
        <div class="zone-card bg-white rounded-2xl p-6 shadow-xl zone-locked" data-zone="4">
          <div class="text-center">
            <div class="text-4xl mb-4">⚡</div>
            <h3 class="game-font text-2xl text-gray-400 mb-2">Blitzrunde</h3>
            <p class="text-gray-400 mb-4">Schnell-Quiz</p>
            <div class="flex justify-between text-sm text-gray-400 mb-4">
              <span>Max: 100 P</span>
              <span id="zone4Score">P: 0</span>
            </div>
            <button class="bg-gray-300 text-gray-500 px-6 py-2 rounded-full cursor-not-allowed">
              🔒 Gesperrt
            </button>
          </div>
        </div>
        <div class="zone-card bg-white rounded-2xl p-6 shadow-xl zone-locked" data-zone="5">
          <div class="text-center">
            <div class="text-4xl mb-4">🌀</div>
            <h3 class="game-font text-2xl text-gray-400 mb-2">Labyrinth der Redewendungen</h3>
            <p class="text-gray-400 mb-4">Szenarien</p>
            <div class="flex justify-between text-sm text-gray-400 mb-4">
              <span>Max: 80 P</span>
              <span id="zone5Score">P: 0</span>
            </div>
            <button class="bg-gray-300 text-gray-500 px-6 py-2 rounded-full cursor-not-allowed">
              🔒 Gesperrt
            </button>
          </div>
        </div>
        <div class="zone-card bg-gradient-to-br from-yellow-400 to-orange-500 rounded-2xl p-6 shadow-xl">
          <div class="text-center text-white">
            <div class="text-4xl mb-4">🏆</div>
            <h3 class="game-font text-2xl mb-2">Dein Rang</h3>
            <p id="playerRank" class="text-lg font-semibold mb-2">Weiter üben 💡</p>
            <div class="text-sm opacity-90">
              <div>🏆 500+ P: Champion</div>
              <div>🧭 400+ P: Entdecker</div>
              <div>💡 0+ P: Anfänger</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="gameScreen" class="hidden container mx-auto px-4 py-8">
      <div class="bg-white/20 backdrop-blur-sm p-4 rounded-2xl mb-6 flex justify-between items-center">
        <button onclick="returnToMenu()"
                class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg">
          ← zurück
        </button>
        <div class="text-center">
          <h2 id="zoneTitle" class="game-font text-2xl text-white"></h2>
          <p id="zoneDescription" class="text-blue-100"></p>
        </div>
        <div class="text-right">
          <div class="text-white font-semibold">
            Punktzahl: <span id="currentScore">0</span>
          </div>
          <div id="timerDisplay" class="text-yellow-300 font-bold hidden"></div>
        </div>
      </div>

      <div id="zone1Game" class="hidden">
        <div class="bg-white p-6 rounded-2xl shadow-xl">
          <div class="flex justify-between mb-2">
            <span class="font-semibold">Fortschritt</span>
            <span id="matchProgress">0/10</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-3 mb-6">
            <div id="matchProgressBar"
                 class="progress-bar bg-blue-500 h-3 rounded-full"
                 style="width:0%"></div>
          </div>
          <div class="grid md:grid-cols-2 gap-8">
            <div>
              <h3 class="font-bold text-lg text-center mb-4">Redewendungen</h3>
              <div id="idiomsColumn" class="space-y-3"></div>
            </div>
            <div>
              <h3 class="font-bold text-lg text-center mb-4">Bedeutungen</h3>
              <div id="meaningsColumn" class="space-y-3"></div>
            </div>
          </div>
          <div class="text-center mt-6">
            <button onclick="checkMatches()"
                    class="bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-full">
              Überprüfen
            </button>
          </div>
        </div>
      </div>

      <div id="zone2Game" class="hidden">
        <div class="bg-white p-6 rounded-2xl shadow-xl max-w-2xl mx-auto">
          <div class="flex justify-between items-center mb-2">
            <span class="font-semibold">Frage <span id="tfQuestionNum">1</span>/10</span>
            <span class="text-red-500 font-semibold">Leben: <span id="livesCount">3</span></span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-3 mb-6">
            <div id="tfProgressBar"
                 class="progress-bar bg-purple-500 h-3 rounded-full"
                 style="width:10%"></div>
          </div>
          <div class="bg-blue-50 p-6 rounded-xl mb-6 text-center">
            <h3 id="tfIdiom" class="text-2xl font-bold text-blue-600 mb-4"></h3>
            <p id="tfDefinition" class="text-lg text-gray-700"></p>
          </div>
          <div class="space-x-4 text-center">
            <button onclick="answerTrueFalse(true)"
                    class="bg-green-500 hover:bg-green-600 text-white px-8 py-4 rounded-full font-bold">
              WAHR
            </button>
            <button onclick="answerTrueFalse(false)"
                    class="bg-red-500 hover:bg-red-600 text-white px-8 py-4 rounded-full font-bold">
              FALSCH
            </button>
          </div>
        </div>
      </div>

      <div id="zone3Game" class="hidden">
        <div class="bg-white p-6 rounded-2xl shadow-xl max-w-2xl mx-auto">
          <div class="mb-2 text-center">
            <span class="font-semibold">Frage <span id="fibQuestionNum">1</span>/10</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-3 mb-6">
            <div id="fibProgressBar"
                 class="progress-bar bg-green-500 h-3 rounded-full"
                 style="width:10%"></div>
          </div>
          <div class="bg-green-50 p-6 rounded-xl mb-6 text-center">
            <p id="fibSentence" class="text-lg text-gray-700 mb-4"></p>
            <select id="fibSelect"
                    class="border-2 border-green-300 p-2 rounded-lg w-full max-w-md mx-auto">
              <option value="">Wähle eine Redewendung …</option>
            </select>
          </div>
          <div class="text-center">
            <button onclick="submitFillBlank()"
                    class="bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-full font-semibold">
              Bestätigen
            </button>
          </div>
        </div>
      </div>

      <div id="zone4Game" class="hidden">
        <div class="bg-white p-6 rounded-2xl shadow-xl max-w-2xl mx-auto">
          <div class="flex justify-between items-center mb-2">
            <span class="font-semibold">Frage <span id="lrQuestionNum">1</span>/10</span>
            <span id="lrTimer" class="text-red-500 font-bold text-2xl">60</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-3 mb-6">
            <div id="lrProgressBar"
                 class="progress-bar bg-yellow-500 h-3 rounded-full"
                 style="width:10%"></div>
          </div>
          <div class="bg-yellow-50 p-6 rounded-xl mb-6 text-center">
            <h3 id="lrIdiom" class="text-2xl font-bold text-yellow-600 mb-4"></h3>
          </div>
          <div id="lrOptions" class="grid grid-cols-2 gap-4"></div>
        </div>
      </div>

      <div id="zone5Game" class="hidden">
        <div class="bg-white p-6 rounded-2xl shadow-xl max-w-3xl mx-auto">
          <div class="flex justify-between items-center mb-2">
            <span class="font-semibold">Szenario <span id="scenarioNum">1</span>/4</span>
            <span class="font-semibold">Finale Herausforderung 🌟</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-3 mb-6">
            <div id="scenarioProgressBar"
                 class="progress-bar bg-purple-500 h-3 rounded-full"
                 style="width:25%"></div>
          </div>
          <div class="bg-purple-50 p-6 rounded-xl mb-6">
            <h3 id="scenarioTitle" class="text-xl font-bold text-purple-600 mb-4"></h3>
            <p id="scenarioDescription" class="text-gray-700 mb-4"></p>
            <p id="scenarioQuestion" class="font-semibold text-gray-800"></p>
          </div>
          <div id="scenarioOptions" class="space-y-3"></div>
        </div>
      </div>

    </div>

    <div id="resultsModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
      <div class="bg-white p-8 rounded-2xl max-w-md mx-4 text-center">
        <div id="resultsIcon" class="text-6xl mb-4"></div>
        <h3 id="resultsTitle" class="game-font text-2xl mb-4"></h3>
        <p id="resultsMessage" class="text-gray-600 mb-6"></p>
        <div id="resultsScore" class="text-3xl font-bold text-blue-600 mb-6"></div>
        <button onclick="closeResults()"
                class="bg-blue-500 hover:bg-blue-600 text-white px-8 py-3 rounded-full font-semibold">
          Weiter
        </button>
      </div>
    </div>

  </div>

  <script>
  // Global state (English identifiers)
  const gameData = {
    totalScore:0, zoneScores:[0,0,0,0,0],
    unlockedZones:[true,false,false,false,false],
    currentZone:0, currentQuestion:0, gameState:{}
  };

  // German zone titles/descriptions
  const zoneInfo = {
    1:{title:'🌟 Bucht der Paare',desc:'Redewendung ↔ Bedeutung'},
    2:{title:'❓ Klippe Wahr/Falsch',desc:'Wahr-oder-Falsch Fragen'},
    3:{title:'✍️ Verborgener Schatz',desc:'Lückentexte'},
    4:{title:'⚡ Blitzrunde',desc:'Schnell-Quiz'},
    5:{title:'🌀 Labyrinth der Redewendungen',desc:'Szenarien'}
  };

  // Sample German idioms
  const idiomsData = {
    zone1:[
      {idiom:"Den Nagel auf den Kopf treffen",meaning:"Etwas genau richtig beurteilen"},
      {idiom:"Jemandem einen Bären aufbinden",meaning:"Jemanden täuschen"},
      {idiom:"Ins Gras beißen",meaning:"Sterben"},
      {idiom:"Tomaten auf den Augen haben",meaning:"Etwas Offensichtliches nicht sehen"},
      {idiom:"Perlen vor die Säue werfen",meaning:"Gutes an Unwürdige verschwenden"},
      {idiom:"Auf Wolke sieben schweben",meaning:"Sehr glücklich sein"},
      {idiom:"Die Katze aus dem Sack lassen",meaning:"Ein Geheimnis verraten"},
      {idiom:"Um den heißen Brei herumreden",meaning:"Das Wichtigste nicht direkt ansprechen"},
      {idiom:"Mit dem Kopf durch die Wand wollen",meaning:"Etwas Unmögliches stur erzwingen"},
      {idiom:"Wo sich Fuchs und Hase gute Nacht sagen",meaning:"An einem sehr abgelegenen Ort"}
    ],
    zone2:[
      {idiom:"Den Nagel auf den Kopf treffen",meaning:"Etwas genau richtig beurteilen",correct:true},
      {idiom:"Jemandem einen Bären aufbinden",meaning:"Jemandem ein Kompliment machen",correct:false},
      {idiom:"Ins Gras beißen",meaning:"Sich hinlegen und ausruhen",correct:false},
      {idiom:"Tomaten auf den Augen haben",meaning:"Etwas Offensichtliches nicht sehen",correct:true},
      {idiom:"Perlen vor die Säue werfen",meaning:"Jemandem ein wertvolles Geschenk machen",correct:false},
      {idiom:"Auf Wolke sieben schweben",meaning:"Sehr verliebt oder glücklich sein",correct:true},
      {idiom:"Die Katze aus dem Sack lassen",meaning:"Ein Geheimnis verraten",correct:true},
      {idiom:"Um den heißen Brei herumreden",meaning:"Direkt zur Sache kommen",correct:false},
      {idiom:"Mit dem Kopf durch die Wand wollen",meaning:"Etwas Unmögliches stur erzwingen",correct:true},
      {idiom:"Wo sich Fuchs und Hase gute Nacht sagen",meaning:"In einer belebten Großstadt",correct:false}
    ],
    zone3:[
      {
        sentence:"Mit deiner Analyse hast du genau ______.",
        answer:"den Nagel auf den Kopf getroffen",
        options:[
          "den Nagel auf den Kopf getroffen",
          "ins Gras gebissen",
          "um den heißen Brei geredet",
          "die Katze aus dem Sack gelassen"
        ]
      },
      {
        sentence:"Sag doch endlich, was los ist, und ______ nicht so ______.",
        answer:"rede um den heißen Brei herum",
        options:[
          "rede um den heißen Brei herum",
          "binde einen Bären auf",
          "lass die Katze aus dem Sack",
          "schwebe auf Wolke sieben"
        ]
      },
       // ... 8 more questions
    ],
    zone4:[
      {idiom:"Ins Gras beißen",options:["Überleben","Scheitern","Sterben","Laufen"],answer:2},
      {idiom:"Tomaten auf den Augen haben",options:["Etwas Offensichtliches nicht sehen","Gut sehen können","Gemüse mögen","Augen rot färben"],answer:0},
      // … 8 more questions
    ],
    zone5:[
      {
        title:"Die Überraschungsparty",
        description:"Dein Freund plant eine Überraschungsparty für seine Schwester. Du erzählst es ihr aber aus Versehen.",
        question:"Welche Redewendung passt zu deiner Tat?",
        options:[
          {text:"Ich habe den Nagel auf den Kopf getroffen.","idiom":"Den Nagel auf den Kopf treffen",correct:false},
          {text:"Ich habe die Katze aus dem Sack gelassen.","idiom":"Die Katze aus dem Sack lassen",correct:true},
          {text:"Ich habe Tomaten auf den Augen gehabt.","idiom":"Tomaten auf den Augen haben",correct:false},
          {text:"Ich wollte mit dem Kopf durch die Wand.","idiom":"Mit dem Kopf durch die Wand wollen",correct:false}
        ]
      },
      // … 3 more scenarios
    ]
  };

  // INITIALIZE
  document.addEventListener('DOMContentLoaded', initGame);

  function initGame(){
    updateDisplay();
  }
  function updateDisplay(){
    document.getElementById('totalScore').textContent=gameData.totalScore;
    document.getElementById('overallProgress').style.width=`${Math.min(gameData.totalScore/530*100,100)}%`; // Max score is 530
    for(let i=0;i<5;i++){
      document.getElementById(`zone${i+1}Score`).textContent=`P: ${gameData.zoneScores[i]}`;
      const z=document.querySelector(`[data-zone="${i+1}"]`);
      const b=z.querySelector('button');
      const elements = z.querySelectorAll('h3, p, span');
      if(gameData.unlockedZones[i]){
        z.classList.remove('zone-locked');
        elements.forEach(el => {
            el.classList.remove('text-gray-400');
            if (el.tagName === 'H3') el.classList.add('text-blue-600');
            else el.classList.add('text-gray-600', 'text-gray-500');
        });
        b.className='bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-full font-semibold';
        b.textContent=gameData.zoneScores[i]>0?'Nochmal spielen':'Starten';
        b.onclick=()=>startZone(i+1);
      }
    }
    const r=document.getElementById('playerRank');
    if(gameData.totalScore>=500) r.textContent='Champion 🏆';
    else if(gameData.totalScore>=400) r.textContent='Entdecker 🧭';
    else r.textContent='Übung macht den Meister 💡';
  }

  function startZone(n){
    gameData.currentZone=n;
    gameData.currentQuestion=0;
    document.getElementById('mainMenu').classList.add('hidden');
    document.getElementById('gameScreen').classList.remove('hidden');
    for(let i=1;i<=5;i++) document.getElementById(`zone${i}Game`).classList.add('hidden');
    document.getElementById(`zone${n}Game`).classList.remove('hidden');
    document.getElementById('zoneTitle').textContent=zoneInfo[n].title;
    document.getElementById('zoneDescription').textContent=zoneInfo[n].desc;
    document.getElementById('currentScore').textContent='0';
    switch(n){
      case 1: initZone1(); break;
      case 2: initZone2(); break;
      case 3: initZone3(); break;
      case 4: initZone4(); break;
      case 5: initZone5(); break;
    }
  }
  function returnToMenu(){
    document.getElementById('gameScreen').classList.add('hidden');
    document.getElementById('mainMenu').classList.remove('hidden');
    updateDisplay();
  }

  // ZONE1
  function initZone1(){
    const idioms=[...idiomsData.zone1];
    const meanings=[...idioms.map(x=>x.meaning)];
    for(let i=meanings.length-1;i>0;i--){
      const j=Math.floor(Math.random()*(i+1));
      [meanings[i],meanings[j]]=[meanings[j],meanings[i]];
    }
    gameData.gameState={idioms,meanings,matches:{}};
    renderMatchingGame();
  }
  function renderMatchingGame(){
    const colI=document.getElementById('idiomsColumn');
    const colM=document.getElementById('meaningsColumn');
    colI.innerHTML=''; colM.innerHTML='';
    gameData.gameState.idioms.forEach(item=>{
      const d=document.createElement('div');
      d.className='drag-item bg-blue-100 border-2 border-blue-300 p-3 rounded-lg text-center';
      d.draggable=true; d.textContent=item.idiom; d.dataset.idiom=item.idiom;
      d.addEventListener('dragstart',e=>e.dataTransfer.setData('text/plain',item.idiom));
      colI.appendChild(d);
    });
    gameData.gameState.meanings.forEach(m=>{
      const dz=document.createElement('div');
      dz.className='drop-zone bg-gray-50 border-2 border-gray-300 p-3 rounded-lg text-center flex items-center justify-center';
      dz.textContent=m; dz.dataset.meaning=m;
      dz.addEventListener('dragover',e=>{e.preventDefault();dz.classList.add('drag-over');});
      dz.addEventListener('dragleave',()=>dz.classList.remove('drag-over'));
      dz.addEventListener('drop',e=>{
        e.preventDefault(); dz.classList.remove('drag-over');
        const idiom=e.dataTransfer.getData('text/plain');
        gameData.gameState.matches[idiom]=dz.dataset.meaning;
        dz.innerHTML=`<div class="font-semibold text-blue-600">${idiom}</div><div class="text-sm text-gray-600">${dz.dataset.meaning}</div>`;
        dz.classList.add('bg-blue-50','border-blue-400');
        document.querySelector(`[data-idiom="${idiom}"]`).style.opacity='.3';
        updateMatchProgress();
      });
      colM.appendChild(dz);
    });
  }
  function updateMatchProgress(){
    const c=Object.keys(gameData.gameState.matches).length;
    document.getElementById('matchProgress').textContent=`${c}/10`;
    document.getElementById('matchProgressBar').style.width=`${c*10}%`;
  }
  function checkMatches(){
    let correct=0;
    gameData.gameState.idioms.forEach(item=>{
      const matchedMeaning = gameData.gameState.matches[item.idiom];
      const dropZoneEl = document.querySelector(`[data-meaning="${matchedMeaning}"]`);
      if(matchedMeaning===item.meaning){
        correct++;
        if (dropZoneEl) dropZoneEl.classList.add('correct-match');
      } else if(matchedMeaning){
        if (dropZoneEl) dropZoneEl.classList.add('wrong-match');
      }
    });
    const sc=correct*10;
    gameData.zoneScores[0]=sc; gameData.totalScore+=sc;
    if(correct>=8) gameData.unlockedZones[1]=true;
    showResults(1,sc,correct,gameData.gameState.idioms.length);
  }

  // ZONE2 (FIXED)
  function initZone2(){
    gameData.gameState={
      questions:[...idiomsData.zone2],
      currentQ:0,score:0,lives:3,correctAnswers:0
    };
    showTF();
  }
  function showTF(){
    const s=gameData.gameState, q=s.questions[s.currentQ];
    document.getElementById('tfQuestionNum').textContent=s.currentQ+1;
    document.getElementById('livesCount').textContent= '❤️'.repeat(s.lives);
    document.getElementById('tfIdiom').textContent=q.idiom;
    document.getElementById('tfDefinition').textContent=`Bedeutung: "${q.meaning}"`;
    document.getElementById('tfProgressBar').style.width=`${(s.currentQ+1)/s.questions.length*100}%`;
  }
  function answerTrueFalse(ans){
    const s = gameData.gameState, q = s.questions[s.currentQ];
    if (ans === q.correct) {
      s.score += 10; s.correctAnswers++;
    } else {
      s.lives--;
    }
    document.getElementById('currentScore').textContent=s.score;
    
    if (s.lives <= 0) {
      gameData.zoneScores[1]=s.score; gameData.totalScore+=s.score;
      showResults(2, s.score, s.correctAnswers, s.questions.length, true);
      return;
    }

    s.currentQ++;
    if(s.currentQ>=s.questions.length){
      gameData.zoneScores[1]=s.score; gameData.totalScore+=s.score; 
      if (s.correctAnswers >= 8) gameData.unlockedZones[2]=true;
      showResults(2,s.score,s.correctAnswers,s.questions.length);
    } else {
      setTimeout(showTF,500);
    }
  }

  // ZONE3
  function initZone3(){
    gameData.gameState={
      questions:[...idiomsData.zone3],
      currentQ:0,score:0,correctAnswers:0
    };
    showFIB();
  }
  function showFIB(){
    const s=gameData.gameState, q=s.questions[s.currentQ];
    document.getElementById('fibQuestionNum').textContent=s.currentQ+1;
    document.getElementById('fibSentence').textContent=q.sentence;
    document.getElementById('fibProgressBar').style.width=`${(s.currentQ+1)/s.questions.length*100}%`;
    const sel=document.getElementById('fibSelect'); sel.innerHTML='<option value="">Wähle …</option>';
    q.options.sort(() => Math.random() - 0.5).forEach(o=>{const opt=document.createElement('option');opt.value=o;opt.textContent=o;sel.appendChild(opt);});
  }
  function submitFillBlank(){
    const s=gameData.gameState, q=s.questions[s.currentQ];
    const ans=document.getElementById('fibSelect').value;
    if(!ans){alert('Bitte wähle eine Antwort.');return;}
    if(ans===q.answer){s.score+=15; s.correctAnswers++;}
    document.getElementById('currentScore').textContent=s.score;
    s.currentQ++;
    if(s.currentQ>=s.questions.length){
      gameData.zoneScores[2]=s.score;gameData.totalScore+=s.score;
      if (s.correctAnswers >= (s.questions.length * 0.8)) gameData.unlockedZones[3]=true;
      showResults(3,s.score,s.correctAnswers,s.questions.length);
    } else setTimeout(showFIB,500);
  }

  // ZONE4
  function initZone4(){
    gameData.gameState={questions:[...idiomsData.zone4],currentQ:0,score:0,timeLeft:60,correctAnswers:0,timer:null};
    startTimer(); showLR();
  }
  function startTimer(){
    const s=gameData.gameState;
    document.getElementById('timerDisplay').classList.remove('hidden');
    s.timer=setInterval(()=>{
      s.timeLeft--;document.getElementById('lrTimer').textContent=s.timeLeft;
      if(s.timeLeft<=10)document.getElementById('lrTimer').classList.add('timer-warning');
      if(s.timeLeft<=0){clearInterval(s.timer);finishLR();}
    },1000);
  }
  function showLR(){
    const s=gameData.gameState, q=s.questions[s.currentQ];
    document.getElementById('lrQuestionNum').textContent=s.currentQ+1;
    document.getElementById('lrIdiom').textContent=q.idiom;
    document.getElementById('lrProgressBar').style.width=`${(s.currentQ+1)/s.questions.length*100}%`;
    const c=document.getElementById('lrOptions'); c.innerHTML='';
    q.options.forEach((o,i)=>{const b=document.createElement('button');
      b.className='bg-yellow-100 hover:bg-yellow-200 border-2 border-yellow-300 p-4 rounded-lg font-semibold';
      b.textContent=o; b.onclick=()=>answerLR(i);c.appendChild(b);});
  }
  function answerLR(i){
    const s=gameData.gameState, q=s.questions[s.currentQ];
    if(i===q.answer){s.score+=10;s.correctAnswers++;} // Simpler scoring
    document.getElementById('currentScore').textContent=s.score;
    s.currentQ++;
    if(s.currentQ>=s.questions.length||s.timeLeft<=0)finishLR();
    else showLR();
  }
  function finishLR(){
    const s=gameData.gameState; clearInterval(s.timer);
    document.getElementById('timerDisplay').classList.add('hidden');
    gameData.zoneScores[3]=s.score;gameData.totalScore+=s.score;
    if (s.correctAnswers >= (s.questions.length * 0.8)) gameData.unlockedZones[4]=true;
    showResults(4,s.score,s.correctAnswers,s.questions.length);
  }

  // ZONE5
  function initZone5(){
    gameData.gameState={scenarios:[...idiomsData.zone5],currentS:0,score:0,correctAnswers:0};
    showScenario();
  }
  function showScenario(){
    const s=gameData.gameState, sc=s.scenarios[s.currentS];
    document.getElementById('scenarioNum').textContent=s.currentS+1;
    document.getElementById('scenarioTitle').textContent=sc.title;
    document.getElementById('scenarioDescription').textContent=sc.description;
    document.getElementById('scenarioQuestion').textContent=sc.question;
    document.getElementById('scenarioProgressBar').style.width=`${(s.currentS+1)/s.scenarios.length*100}%`;
    const c=document.getElementById('scenarioOptions'); c.innerHTML='';
    sc.options.forEach((o,i)=>{const b=document.createElement('button');
      b.className='bg-purple-100 hover:bg-purple-200 border-2 border-purple-300 p-4 rounded-lg w-full text-left';
      b.innerHTML=`<div class="font-semibold">${o.text}</div><div class="text-sm text-gray-600 mt-1">Verwendet: "${o.idiom}"</div>`;
      b.onclick=()=>answerScenario(i);c.appendChild(b);});
  }
  function answerScenario(i){
    const s=gameData.gameState, sc=s.scenarios[s.currentS];
    if(sc.options[i].correct){s.score+=20;s.correctAnswers++;}
    document.getElementById('currentScore').textContent=s.score;
    s.currentS++;
    if(s.currentS>=s.scenarios.length){
      gameData.zoneScores[4]=s.score;gameData.totalScore+=s.score;
      showResults(5,s.score,s.correctAnswers,s.scenarios.length);
    } else setTimeout(showScenario,500);
  }

  // RESULTS (FIXED)
  function showResults(z,score,correct,total, gameOver = false){
    const m=document.getElementById('resultsModal'),
          i=document.getElementById('resultsIcon'),
          t=document.getElementById('resultsTitle'),
          msg=document.getElementById('resultsMessage'),
          scEl=document.getElementById('resultsScore'),
          pct= total > 0 ? Math.round(correct/total*100) : 0;
    
    if (gameOver) {
        i.textContent = '💔';
        t.textContent = 'Spiel vorbei!';
        msg.textContent = 'Du hast keine Leben mehr. Übe mehr und versuche es erneut!';
    } else if(pct>=80){
        i.textContent='🎉';t.textContent='Ausgezeichnet!';msg.textContent=`Du hast diese Zone mit ${pct}% richtigen Antworten gemeistert!`;
    } else if(pct>=60){
        i.textContent='👍';t.textContent='Gut gemacht!';msg.textContent=`Du hattest ${pct}% richtig. Weiter so!`;
    } else {
        i.textContent='💪';t.textContent='Weiter üben!';msg.textContent=`Du hattest ${pct}% richtig. Übung macht den Meister!`;
    }
    scEl.textContent=`+${score} P`;
    m.classList.remove('hidden');
  }
  function closeResults(){
    document.getElementById('resultsModal').classList.add('hidden');
    returnToMenu();
  }
  </script>
</body>
</html>