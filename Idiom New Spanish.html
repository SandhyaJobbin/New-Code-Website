<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Aventura en la Isla de Modismos</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&family=Inter:wght@400;500;600;700&display=swap');
    .game-font { font-family: 'Fredoka One', cursive; }
    .body-font { font-family: 'Inter', sans-serif; }
    .island-bg { background: linear-gradient(135deg, #f6d365 0%, #fda085 100%); min-height:100vh; }
    .zone-card { transition: all 0.3s ease; }
    .zone-card:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,.1); }
    .zone-locked { opacity: .6; filter: grayscale(100%); }
    .progress-bar { transition: width .5s ease; }
    .drag-item { cursor: grab; }
    .drop-zone { min-height: 60px; transition: all .2s ease; }
    .drop-zone.drag-over { background-color: #e0f2fe; border-color: #0284c7; }
    .correct-match { background-color: #dcfce7!important; border-color: #16a34a!important; }
    .wrong-match { background-color: #fef2f2!important; border-color: #dc2626!important; }
    @keyframes bounce { 0%,20%,50%,80%,100%{transform:translateY(0);}40%{transform:translateY(-10px);}60%{transform:translateY(-5px);} }
    .bounce-animation { animation: bounce .6s; }
    .timer-warning { animation: pulse 1s infinite; }
    @keyframes pulse { 0%{opacity:1;}50%{opacity:.5;}100%{opacity:1;} }
  </style>
</head>
<body class="island-bg body-font">
  <div id="app" class="min-h-screen">

    <div id="mainMenu" class="container mx-auto px-4 py-8">
      <div class="text-center mb-12">
        <h1 class="game-font text-6xl text-white mb-4">üèùÔ∏è Isla de Modismos</h1>
        <p class="text-xl text-yellow-100 mb-8">
          ¬°Domina 100 modismos en espa√±ol con divertidos retos!
        </p>
        <div class="bg-white/20 backdrop-blur-sm rounded-2xl p-6 max-w-md mx-auto mb-8">
          <div class="flex justify-between items-center mb-4">
            <span class="text-white font-semibold">Puntuaci√≥n total:</span>
            <span id="totalScore" class="text-2xl font-bold text-yellow-300">0</span>
          </div>
          <div class="w-full bg-white/20 rounded-full h-3">
            <div id="overallProgress"
                 class="progress-bar bg-gradient-to-r from-yellow-400 to-orange-500 h-3 rounded-full"
                 style="width:0%"></div>
          </div>
          <p class="text-yellow-100 text-sm mt-2">Progreso hacia Maestro de Modismos</p>
        </div>
      </div>

      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-6xl mx-auto">
        <div class="zone-card bg-white rounded-2xl p-6 shadow-xl" data-zone="1">
          <div class="text-center">
            <div class="text-4xl mb-4">üåü</div>
            <h3 class="game-font text-2xl text-orange-600 mb-2">Bah√≠a de Parejas</h3>
            <p class="text-gray-600 mb-4">Modismo ‚Üî Significado</p>
            <div class="flex justify-between text-sm text-gray-500 mb-4">
              <span>M√°x: 100 P</span>
              <span id="zone1Score">P: 0</span>
            </div>
            <button onclick="startZone(1)"
                    class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-2 rounded-full">
              Iniciar Aventura
            </button>
          </div>
        </div>

        <div class="zone-card bg-white rounded-2xl p-6 shadow-xl zone-locked" data-zone="2">
          <div class="text-center">
            <div class="text-4xl mb-4">‚ùì</div>
            <h3 class="game-font text-2xl text-gray-400 mb-2">Acantilado V/F</h3>
            <p class="text-gray-400 mb-4">Verdadero o Falso</p>
            <div class="flex justify-between text-sm text-gray-400 mb-4">
              <span>M√°x: 100 P</span>
              <span id="zone2Score">P: 0</span>
            </div>
            <button disabled class="bg-gray-300 text-gray-500 px-6 py-2 rounded-full cursor-not-allowed">
              üîí Bloqueado
            </button>
          </div>
        </div>

        <div class="zone-card bg-white rounded-2xl p-6 shadow-xl zone-locked" data-zone="3">
          <div class="text-center">
            <div class="text-4xl mb-4">‚úçÔ∏è</div>
            <h3 class="game-font text-2xl text-gray-400 mb-2">Tesoro Escondido</h3>
            <p class="text-gray-400 mb-4">Llenar espacios</p>
            <div class="flex justify-between text-sm text-gray-400 mb-4">
              <span>M√°x: 150 P</span>
              <span id="zone3Score">P: 0</span>
            </div>
            <button disabled class="bg-gray-300 text-gray-500 px-6 py-2 rounded-full cursor-not-allowed">
              üîí Bloqueado
            </button>
          </div>
        </div>

        <div class="zone-card bg-white rounded-2xl p-6 shadow-xl zone-locked" data-zone="4">
          <div class="text-center">
            <div class="text-4xl mb-4">‚ö°</div>
            <h3 class="game-font text-2xl text-gray-400 mb-2">Ronda Rel√°mpago</h3>
            <p class="text-gray-400 mb-4">Quiz r√°pido</p>
            <div class="flex justify-between text-sm text-gray-400 mb-4">
              <span>M√°x: 100 P</span>
              <span id="zone4Score">P: 0</span>
            </div>
            <button disabled class="bg-gray-300 text-gray-500 px-6 py-2 rounded-full cursor-not-allowed">
              üîí Bloqueado
            </button>
          </div>
        </div>

        <div class="zone-card bg-white rounded-2xl p-6 shadow-xl zone-locked" data-zone="5">
          <div class="text-center">
            <div class="text-4xl mb-4">üåÄ</div>
            <h3 class="game-font text-2xl text-gray-400 mb-2">Laberinto de Modismos</h3>
            <p class="text-gray-400 mb-4">Escenarios</p>
            <div class="flex justify-between text-sm text-gray-400 mb-4">
              <span>M√°x: 150 P</span>
              <span id="zone5Score">P: 0</span>
            </div>
            <button disabled class="bg-gray-300 text-gray-500 px-6 py-2 rounded-full cursor-not-allowed">
              üîí Bloqueado
            </button>
          </div>
        </div>

        <div class="zone-card bg-gradient-to-br from-yellow-400 to-orange-500 rounded-2xl p-6 shadow-xl">
          <div class="text-center text-white">
            <div class="text-4xl mb-4">üèÜ</div>
            <h3 class="game-font text-2xl mb-2">Tu Rango</h3>
            <p id="playerRank" class="text-lg font-semibold mb-2">¬°A practicar! üí°</p>
            <div class="text-sm opacity-90">
              <div>üèÜ 500+ P: Maestro</div>
              <div>üß≠ 400+ P: Explorador</div>
              <div>üí° 0+ P: Principiante</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="gameScreen" class="hidden container mx-auto px-4 py-8">
      <div class="bg-white/20 backdrop-blur-sm p-4 rounded-2xl mb-6 flex justify-between items-center">
        <button onclick="returnToMenu()"
                class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg">
          ‚Üê Volver
        </button>
        <div class="text-center">
          <h2 id="zoneTitle" class="game-font text-2xl text-white"></h2>
          <p id="zoneDescription" class="text-yellow-100"></p>
        </div>
        <div class="text-right">
          <div class="text-white font-semibold">
            Puntos: <span id="currentScore">0</span>
          </div>
          <div id="timerDisplay" class="text-yellow-300 font-bold text-2xl"></div>
        </div>
      </div>

      <div id="zone1Game" class="hidden">
        <div class="bg-white p-6 rounded-2xl shadow-xl">
          <div class="flex justify-between mb-2">
            <span class="font-semibold">Progreso</span>
            <span id="matchProgress">0/10</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-3 mb-6">
            <div id="matchProgressBar" class="progress-bar bg-orange-500 h-3 rounded-full" style="width:0%"></div>
          </div>
          <div class="grid md:grid-cols-2 gap-8">
            <div>
              <h3 class="font-bold text-lg text-center mb-4">Modismos</h3>
              <div id="idiomsColumn" class="space-y-3"></div>
            </div>
            <div>
              <h3 class="font-bold text-lg text-center mb-4">Significados</h3>
              <div id="meaningsColumn" class="space-y-3"></div>
            </div>
          </div>
          <div class="text-center mt-6">
            <button onclick="checkMatches()" class="bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-full">
              Verificar
            </button>
          </div>
        </div>
      </div>

      <div id="zone2Game" class="hidden">
          <div class="bg-white rounded-2xl p-6 shadow-xl max-w-2xl mx-auto">
              <div class="mb-6">
                  <div class="flex justify-between items-center mb-2">
                      <span class="font-semibold">Pregunta <span id="tfQuestionNum">1</span>/10</span>
                      <span class="text-red-500 font-semibold">Vidas: <span id="livesCount">3</span></span>
                  </div>
                  <div class="w-full bg-gray-200 rounded-full h-3">
                      <div id="tfProgressBar" class="progress-bar bg-purple-500 h-3 rounded-full" style="width: 10%"></div>
                  </div>
              </div>
              <div class="text-center mb-8">
                  <div class="bg-blue-50 rounded-xl p-6 mb-6">
                      <h3 class="text-2xl font-bold text-blue-600 mb-4" id="tfIdiom"></h3>
                      <p class="text-lg text-gray-700" id="tfDefinition"></p>
                  </div>
                  <div class="space-x-4">
                      <button onclick="answerTrueFalse(true)" class="bg-green-500 hover:bg-green-600 text-white px-8 py-4 rounded-full font-bold text-xl">
                          ‚úì VERDADERO
                      </button>
                      <button onclick="answerTrueFalse(false)" class="bg-red-500 hover:bg-red-600 text-white px-8 py-4 rounded-full font-bold text-xl">
                          ‚úó FALSO
                      </button>
                  </div>
              </div>
          </div>
      </div>

      <div id="zone3Game" class="hidden">
          <div class="bg-white rounded-2xl p-6 shadow-xl max-w-2xl mx-auto">
              <div class="mb-6">
                  <div class="flex justify-between items-center mb-2">
                      <span class="font-semibold">Pregunta <span id="fibQuestionNum">1</span>/5</span>
                  </div>
                  <div class="w-full bg-gray-200 rounded-full h-3">
                      <div id="fibProgressBar" class="progress-bar bg-green-500 h-3 rounded-full" style="width: 20%"></div>
                  </div>
              </div>
              <div class="text-center mb-8">
                  <div class="bg-green-50 rounded-xl p-6 mb-6">
                      <p class="text-lg text-gray-700 mb-4" id="fibSentence"></p>
                      <select id="fibSelect" class="border-2 border-green-300 rounded-lg px-4 py-2 text-lg font-semibold bg-white">
                          <option value="">Selecciona...</option>
                      </select>
                  </div>
                  <button onclick="submitFillBlank()" class="bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-full font-semibold mb-4">
                      Responder
                  </button>
              </div>
          </div>
      </div>

      <div id="zone4Game" class="hidden">
          <div class="bg-white rounded-2xl p-6 shadow-xl max-w-2xl mx-auto">
              <div class="mb-6">
                  <div class="flex justify-between items-center mb-2">
                      <span class="font-semibold">Pregunta <span id="lrQuestionNum">1</span>/5</span>
                      <span id="lrTimer" class="text-2xl font-bold text-red-500">60</span>
                  </div>
                  <div class="w-full bg-gray-200 rounded-full h-3">
                      <div id="lrProgressBar" class="progress-bar bg-yellow-500 h-3 rounded-full" style="width: 20%"></div>
                  </div>
              </div>
              <div class="text-center mb-8">
                  <div class="bg-yellow-50 rounded-xl p-6 mb-6">
                      <h3 class="text-2xl font-bold text-yellow-600 mb-4" id="lrIdiom"></h3>
                  </div>
                  <div class="grid grid-cols-2 gap-4" id="lrOptions"></div>
              </div>
          </div>
      </div>

      <div id="zone5Game" class="hidden">
          <div class="bg-white rounded-2xl p-6 shadow-xl max-w-3xl mx-auto">
              <div class="mb-6">
                  <div class="flex justify-between items-center mb-2">
                      <span class="font-semibold">Escenario <span id="scenarioNum">1</span>/2</span>
                      <span class="font-semibold">¬°Desaf√≠o Final! üåü</span>
                  </div>
                  <div class="w-full bg-gray-200 rounded-full h-3">
                      <div id="scenarioProgressBar" class="progress-bar bg-purple-500 h-3 rounded-full" style="width: 50%"></div>
                  </div>
              </div>
              <div class="mb-8">
                  <div class="bg-purple-50 rounded-xl p-6 mb-6">
                      <h3 class="text-xl font-bold text-purple-600 mb-4" id="scenarioTitle"></h3>
                      <p class="text-gray-700 mb-4" id="scenarioDescription"></p>
                      <p class="font-semibold text-gray-800" id="scenarioQuestion"></p>
                  </div>
                  <div class="space-y-3" id="scenarioOptions"></div>
              </div>
          </div>
      </div>
    </div>

    <div id="resultsModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
      <div class="bg-white p-8 rounded-2xl max-w-md mx-4 text-center">
        <div id="resultsIcon" class="text-6xl mb-4"></div>
        <h3 id="resultsTitle" class="game-font text-2xl mb-4"></h3>
        <p id="resultsMessage" class="text-gray-600 mb-6"></p>
        <div id="resultsScore" class="text-3xl font-bold text-orange-600 mb-6"></div>
        <button onclick="closeResults()"
                class="bg-orange-500 hover:bg-orange-600 text-white px-8 py-3 rounded-full">
          Continuar
        </button>
      </div>
    </div>

  </div>

  <script>
    const gameData = {
      totalScore: 0,
      zoneScores: [0, 0, 0, 0, 0],
      unlockedZones: [true, false, false, false, false],
      currentZone: null,
      gameState: {}
    };

    const zoneInfo = {
      1: { title: 'üåü Bah√≠a de Parejas', desc: 'Modismo ‚Üî Significado', maxScore: 100 },
      2: { title: '‚ùì Acantilado V/F', desc: 'Verdadero o Falso', maxScore: 100 },
      3: { title: '‚úçÔ∏è Tesoro Escondido', desc: 'Llenar espacios', maxScore: 150 },
      4: { title: '‚ö° Ronda Rel√°mpago', desc: 'Quiz r√°pido', maxScore: 100 },
      5: { title: 'üåÄ Laberinto de Modismos', desc: 'Escenarios', maxScore: 150 }
    };

    const idiomsData = {
      zone1: [
        { idiom: 'Dar en el clavo', meaning: 'Atinar con precisi√≥n' },
        { idiom: 'Estar en las nubes', meaning: 'Estar distra√≠do' },
        { idiom: 'Costar un ojo de la cara', meaning: 'Ser muy caro' },
        { idiom: 'Meter la pata', meaning: 'Cometer un error' },
        { idiom: 'Tirar la toalla', meaning: 'Rendirse' },
        { idiom: 'Hacer la vista gorda', meaning: 'Ignorar voluntariamente' },
        { idiom: 'Sacarse las casta√±as del fuego', meaning: 'Resolver solo un problema' },
        { idiom: 'Quedarse de piedra', meaning: 'Sorprenderse mucho' },
        { idiom: 'Tomar el toro por los cuernos', meaning: 'Enfrentar un reto' },
        { idiom: 'Buscar tres pies al gato', meaning: 'Complicar innecesariamente' }
      ],
      zone2: [
          { idiom: 'No tener pelos en la lengua', meaning: 'Decir lo que se piensa sin rodeos', correct: true },
          { idiom: 'Ahogarse en un vaso de agua', meaning: 'Preocuparse demasiado por un problema peque√±o', correct: true },
          { idiom: 'Bailar con la m√°s fea', meaning: 'Tener una fiesta divertida', correct: false },
          { idiom: 'Echar le√±a al fuego', meaning: 'Empeorar una situaci√≥n', correct: true },
          { idiom: 'Ponerse las pilas', meaning: 'Descansar mucho', correct: false },
          { idiom: 'Ser pan comido', meaning: 'Ser algo muy f√°cil de hacer', correct: true },
          { idiom: 'Estar hasta en la sopa', meaning: 'Estar en todas partes', correct: true },
          { idiom: 'Dormirse en los laureles', meaning: 'Conformarse con √©xitos pasados y no seguir esforz√°ndose', correct: true },
          { idiom: 'Hablar por los codos', meaning: 'Ser una persona muy callada', correct: false },
          { idiom: 'Verle las orejas al lobo', meaning: 'Sentir un peligro cercano', correct: true }
      ],
      zone3: [
          { sentence: "No te rindas ahora, no puedes _______.", answer: "Tirar la toalla", options: ["Tirar la toalla", "Meter la pata", "Dar en el clavo", "Estar en las nubes"] },
          { sentence: "Esa chaqueta de dise√±ador debe _______.", answer: "Costar un ojo de la cara", options: ["Costar un ojo de la cara", "Buscar tres pies al gato", "Tomar el toro por los cuernos", "Quedarse de piedra"] },
          { sentence: "No compliques las cosas, dejas de _______.", answer: "Buscar tres pies al gato", options: ["Buscar tres pies al gato", "Hacer la vista gorda", "Estar en las nubes", "Tirar la toalla"] },
          { sentence: "¬°Ten cuidado de no _______ con ese comentario!", answer: "Meter la pata", options: ["Meter la pata", "Quedarse de piedra", "Dar en el clavo", "Sacarse las casta√±as del fuego"] },
          { sentence: "Hay que _______ y resolver este problema ya.", answer: "Tomar el toro por los cuernos", options: ["Tomar el toro por los cuernos", "Estar en las nubes", "Hacer la vista gorda", "Tirar la toalla"] }
      ],
      zone4: [
          { idiom: "Dar en el clavo", options: ["Fallar", "Atinar con precisi√≥n", "Clavar algo", "Dolerse"], answer: 1 },
          { idiom: "Estar en las nubes", options: ["Volar", "Estar atento", "Estar distra√≠do", "Llover"], answer: 2 },
          { idiom: "Tirar la toalla", options: ["Secarse", "Luchar", "Rendirse", "Limpiar"], answer: 2 },
          { idiom: "Meter la pata", options: ["Nadar", "Cometer un error", "Caminar", "Jugar"], answer: 1 },
          { idiom: "Ser pan comido", options: ["Ser muy f√°cil", "Tener hambre", "Ser delicioso", "Ser muy dif√≠cil"], answer: 0 }
      ],
      zone5: [
          {
              title: "Un problema en el trabajo",
              description: "Tu equipo enfrenta un desaf√≠o complicado y nadie sabe por d√≥nde empezar.",
              question: "¬øQu√© acci√≥n describe mejor la actitud correcta?",
              options: [
                  { text: "Tomar el toro por los cuernos y liderar.", idiom: "Tomar el toro por los cuernos", correct: true },
                  { text: "Tirar la toalla y esperar a que alguien m√°s lo haga.", idiom: "Tirar la toalla", correct: false }
              ]
          },
          {
              title: "Un secreto revelado",
              description: "Durante una conversaci√≥n, tu amigo accidentalmente cuenta un secreto.",
              question: "¬øQu√© modismo describe su acci√≥n?",
              options: [
                  { text: "Acaba de meter la pata.", idiom: "Meter la pata", correct: true },
                  { text: "Acaba de dar en el clavo.", idiom: "Dar en el clavo", correct: false }
              ]
          }
      ]
    };

    function updateDisplay() {
        document.getElementById('totalScore').textContent = gameData.totalScore;
        const totalMaxScore = Object.values(zoneInfo).reduce((sum, zone) => sum + zone.maxScore, 0);
        document.getElementById('overallProgress').style.width = `${(gameData.totalScore / totalMaxScore) * 100}%`;
        
        for (let i = 1; i <= 5; i++) {
            const zoneCard = document.querySelector(`[data-zone="${i}"]`);
            const btn = zoneCard.querySelector('button');
            const elements = zoneCard.querySelectorAll('h3, p, span');
            document.getElementById(`zone${i}Score`).textContent = `P: ${gameData.zoneScores[i-1]}`;

            if (gameData.unlockedZones[i-1]) {
                zoneCard.classList.remove('zone-locked');
                elements.forEach(el => {
                    el.classList.remove('text-gray-400');
                    if(el.tagName === 'H3') el.classList.add('text-orange-600');
                    else el.classList.add('text-gray-600', 'text-gray-500');
                });
                btn.textContent = gameData.zoneScores[i-1] > 0 ? 'Jugar de Nuevo' : 'Iniciar Aventura';
                btn.classList.remove('cursor-not-allowed', 'bg-gray-300', 'text-gray-500');
                btn.classList.add('bg-orange-500', 'hover:bg-orange-600', 'text-white');
                btn.disabled = false;
                btn.onclick = () => startZone(i);
            } else {
                zoneCard.classList.add('zone-locked');
                elements.forEach(el => {
                    el.classList.add('text-gray-400');
                     el.classList.remove('text-orange-600', 'text-gray-600', 'text-gray-500');
                });
                btn.textContent = 'üîí Bloqueado';
                btn.classList.add('cursor-not-allowed', 'bg-gray-300', 'text-gray-500');
                btn.disabled = true;
                btn.onclick = null;
            }
        }
        updatePlayerRank();
    }

    function updatePlayerRank() {
        const rankEl = document.getElementById('playerRank');
        if (gameData.totalScore >= 500) rankEl.textContent = 'Maestro üèÜ';
        else if (gameData.totalScore >= 400) rankEl.textContent = 'Explorador üß≠';
        else rankEl.textContent = 'Principiante üí°';
    }

    function startZone(zone) {
      if (!gameData.unlockedZones[zone - 1]) return;
      gameData.currentZone = zone;
      document.getElementById('mainMenu').classList.add('hidden');
      document.getElementById('gameScreen').classList.remove('hidden');

      document.getElementById('zoneTitle').innerText = zoneInfo[zone].title;
      document.getElementById('zoneDescription').innerText = zoneInfo[zone].desc;

      for (let z = 1; z <= 5; z++) {
        document.getElementById(`zone${z}Game`).classList.add('hidden');
      }
      document.getElementById(`zone${zone}Game`).classList.remove('hidden');
      document.getElementById('timerDisplay').classList.add('hidden');

      gameData.gameState = {};
      document.getElementById('currentScore').innerText = 0;

      if (zone === 1) initZone1();
      if (zone === 2) initZone2();
      if (zone === 3) initZone3();
      if (zone === 4) initZone4();
      if (zone === 5) initZone5();
    }
    
    function returnToMenu() {
      if (gameData.gameState.timer) clearInterval(gameData.gameState.timer);
      document.getElementById('gameScreen').classList.add('hidden');
      document.getElementById('mainMenu').classList.remove('hidden');
      updateDisplay();
    }

    function closeResults() {
      document.getElementById('resultsModal').classList.add('hidden');
      returnToMenu();
    }
    
    // Zone 1
    function initZone1() {
        const idioms = [...idiomsData.zone1];
        const meanings = idioms.map(i => i.meaning).sort(() => Math.random() - 0.5);
        const idiomsCol = document.getElementById('idiomsColumn');
        const meaningsCol = document.getElementById('meaningsColumn');
        idiomsCol.innerHTML = '';
        meaningsCol.innerHTML = '';

        idioms.forEach((item, idx) => {
            const div = document.createElement('div');
            div.className = 'drag-item p-3 bg-orange-100 border-2 border-orange-300 rounded-lg text-center';
            div.draggable = true;
            div.id = `idiom-${idx}`;
            div.dataset.idiomText = item.idiom;
            div.innerText = item.idiom;
            div.addEventListener('dragstart', e => e.dataTransfer.setData('text/plain', e.target.id));
            idiomsCol.appendChild(div);
        });

        meanings.forEach((meaning, idx) => {
            const div = document.createElement('div');
            div.className = 'drop-zone p-3 bg-gray-100 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center';
            div.dataset.meaning = meaning;
            div.addEventListener('dragover', e => { e.preventDefault(); e.currentTarget.classList.add('drag-over'); });
            div.addEventListener('dragleave', e => e.currentTarget.classList.remove('drag-over'));
            div.addEventListener('drop', e => {
                e.preventDefault();
                e.currentTarget.classList.remove('drag-over');
                const draggedId = e.dataTransfer.getData('text/plain');
                const draggedElem = document.getElementById(draggedId);

                if (e.currentTarget.children.length > 0) {
                    const existingElem = e.currentTarget.children[0];
                    idiomsCol.appendChild(existingElem);
                }
                e.currentTarget.appendChild(draggedElem);
                updateMatchProgress();
            });
            const p = document.createElement('p');
            p.textContent = meaning;
            div.appendChild(p);
            meaningsCol.appendChild(div);
        });
        
        gameData.gameState.matches = {};
        updateMatchProgress();
    }

    function updateMatchProgress() {
        const meaningsCol = document.getElementById('meaningsColumn');
        const filledZones = Array.from(meaningsCol.children).filter(child => child.children.length > 1).length;
        document.getElementById('matchProgress').innerText = `${filledZones}/10`;
        document.getElementById('matchProgressBar').style.width = `${filledZones * 10}%`;
    }

    function checkMatches() {
        let correctCount = 0;
        const meaningsCol = document.getElementById('meaningsColumn');
        
        Array.from(meaningsCol.children).forEach(dropZone => {
            const meaning = dropZone.dataset.meaning;
            const idiomElem = dropZone.querySelector('.drag-item');
            if (!idiomElem) return;

            const idiomText = idiomElem.dataset.idiomText;
            const correctPair = idiomsData.zone1.find(p => p.idiom === idiomText);
            
            if (correctPair && correctPair.meaning === meaning) {
                correctCount++;
                dropZone.classList.add('correct-match');
            } else {
                dropZone.classList.add('wrong-match');
            }
        });
        
        const zonePts = correctCount * 10;
        const oldScore = gameData.zoneScores[0];
        gameData.zoneScores[0] = zonePts;
        gameData.totalScore = gameData.totalScore - oldScore + zonePts;
        if (correctCount >= 8) gameData.unlockedZones[1] = true;
        
        showResults(1, zonePts, correctCount, 10);
    }
    
    // Other Zones
    function initZone2() {
        gameData.gameState = {
            questions: [...idiomsData.zone2].sort(() => Math.random() - 0.5),
            currentQ: 0,
            score: 0,
            lives: 3,
            correctAnswers: 0
        };
        showTrueFalseQuestion();
    }

    function showTrueFalseQuestion() {
        const s = gameData.gameState;
        const q = s.questions[s.currentQ];
        document.getElementById('tfQuestionNum').textContent = s.currentQ + 1;
        document.getElementById('livesCount').textContent = '‚ù§Ô∏è'.repeat(s.lives);
        document.getElementById('tfIdiom').textContent = q.idiom;
        document.getElementById('tfDefinition').textContent = `Significado: "${q.meaning}"`;
        document.getElementById('tfProgressBar').style.width = `${((s.currentQ + 1) / s.questions.length) * 100}%`;
    }

    function answerTrueFalse(userAns) {
        const s = gameData.gameState;
        if (s.currentQ >= s.questions.length) return;
        const q = s.questions[s.currentQ];
        if (userAns === q.correct) {
            s.score += 10;
            s.correctAnswers++;
        } else {
            s.lives--;
        }
        document.getElementById('currentScore').textContent = s.score;
        s.currentQ++;
        if (s.lives <= 0) {
            const oldScore = gameData.zoneScores[1];
            gameData.zoneScores[1] = s.score;
            gameData.totalScore = gameData.totalScore - oldScore + s.score;
            showResults(2, s.score, s.correctAnswers, s.questions.length, true);
            return;
        }
        if (s.currentQ >= s.questions.length) {
            const oldScore = gameData.zoneScores[1];
            gameData.zoneScores[1] = s.score;
            gameData.totalScore = gameData.totalScore - oldScore + s.score;
            if (s.correctAnswers >= 8) gameData.unlockedZones[2] = true;
            showResults(2, s.score, s.correctAnswers, s.questions.length);
        } else {
            showTrueFalseQuestion();
        }
    }

    function initZone3() {
        gameData.gameState = {
            questions: [...idiomsData.zone3].sort(() => Math.random() - 0.5),
            currentQ: 0,
            score: 0,
            correctAnswers: 0
        };
        showFillBlankQuestion();
    }

    function showFillBlankQuestion() {
        const s = gameData.gameState;
        const q = s.questions[s.currentQ];
        document.getElementById('fibQuestionNum').textContent = s.currentQ + 1;
        document.getElementById('fibSentence').textContent = q.sentence;
        document.getElementById('fibProgressBar').style.width = `${((s.currentQ + 1) / s.questions.length) * 100}%`;
        const sel = document.getElementById('fibSelect');
        sel.innerHTML = `<option value="">Selecciona...</option>`;
        q.options.sort(() => Math.random() - 0.5).forEach(o => {
            const opt = document.createElement('option');
            opt.value = o;
            opt.textContent = o;
            sel.appendChild(opt);
        });
    }

    function submitFillBlank() {
        const s = gameData.gameState;
        if (s.currentQ >= s.questions.length) return;
        const q = s.questions[s.currentQ];
        const ans = document.getElementById('fibSelect').value;
        if (!ans) { alert('¬°Por favor, selecciona una opci√≥n!'); return; }
        if (ans === q.answer) {
            s.score += 30;
            s.correctAnswers++;
        }
        document.getElementById('currentScore').textContent = s.score;
        s.currentQ++;
        if (s.currentQ >= s.questions.length) {
            const oldScore = gameData.zoneScores[2];
            gameData.zoneScores[2] = s.score;
            gameData.totalScore = gameData.totalScore - oldScore + s.score;
            if (s.correctAnswers >= 4) gameData.unlockedZones[3] = true;
            showResults(3, s.score, s.correctAnswers, s.questions.length);
        } else {
            showFillBlankQuestion();
        }
    }

    function initZone4() {
        gameData.gameState = {
            questions: [...idiomsData.zone4].sort(() => Math.random() - 0.5),
            currentQ: 0, score: 0, timeLeft: 60, correctAnswers: 0, timer: null
        };
        document.getElementById('timerDisplay').classList.remove('hidden');
        document.getElementById('lrTimer').classList.remove('timer-warning');
        document.getElementById('lrTimer').textContent = gameData.gameState.timeLeft;
        gameData.gameState.timer = setInterval(() => {
            gameData.gameState.timeLeft--;
            document.getElementById('timerDisplay').textContent = `Tiempo: ${gameData.gameState.timeLeft}`;
            if (gameData.gameState.timeLeft <= 10) document.getElementById('timerDisplay').classList.add('timer-warning');
            if (gameData.gameState.timeLeft <= 0) finishLightningRound();
        }, 1000);
        showLightningQuestion();
    }

    function showLightningQuestion() {
        const s = gameData.gameState;
        const q = s.questions[s.currentQ];
        document.getElementById('lrQuestionNum').textContent = s.currentQ + 1;
        document.getElementById('lrIdiom').textContent = q.idiom;
        document.getElementById('lrProgressBar').style.width = `${((s.currentQ + 1) / s.questions.length) * 100}%`;
        const optionsContainer = document.getElementById('lrOptions');
        optionsContainer.innerHTML = '';
        q.options.forEach((opt, index) => {
            const btn = document.createElement('button');
            btn.className = 'bg-yellow-100 hover:bg-yellow-200 border-2 border-yellow-300 rounded-lg p-4 font-semibold';
            btn.textContent = opt;
            btn.onclick = () => answerLightning(index);
            optionsContainer.appendChild(btn);
        });
    }

    function answerLightning(selectedIndex) {
        const s = gameData.gameState;
        if (s.currentQ >= s.questions.length) return;
        const q = s.questions[s.currentQ];
        if (selectedIndex === q.answer) {
            s.score += 20;
            s.correctAnswers++;
        }
        document.getElementById('currentScore').textContent = s.score;
        s.currentQ++;
        if (s.currentQ >= s.questions.length) {
            finishLightningRound();
        } else {
            showLightningQuestion();
        }
    }

    function finishLightningRound() {
        const s = gameData.gameState;
        clearInterval(s.timer);
        document.getElementById('timerDisplay').classList.add('hidden');
        const oldScore = gameData.zoneScores[3];
        gameData.zoneScores[3] = s.score;
        gameData.totalScore = gameData.totalScore - oldScore + s.score;
        if (s.correctAnswers >= 4) gameData.unlockedZones[4] = true;
        showResults(4, s.score, s.correctAnswers, s.questions.length);
    }
    
    function initZone5() {
        gameData.gameState = {
            scenarios: [...idiomsData.zone5].sort(() => Math.random() - 0.5),
            currentS: 0, score: 0, correctAnswers: 0
        };
        showScenario();
    }

    function showScenario() {
        const s = gameData.gameState;
        const scenario = s.scenarios[s.currentS];
        document.getElementById('scenarioNum').textContent = s.currentS + 1;
        document.getElementById('scenarioTitle').textContent = scenario.title;
        document.getElementById('scenarioDescription').textContent = scenario.description;
        document.getElementById('scenarioQuestion').textContent = scenario.question;
        document.getElementById('scenarioProgressBar').style.width = `${((s.currentS + 1) / s.scenarios.length) * 100}%`;
        const optionsContainer = document.getElementById('scenarioOptions');
        optionsContainer.innerHTML = '';
        scenario.options.forEach((opt, index) => {
            const btn = document.createElement('button');
            btn.className = 'bg-purple-100 hover:bg-purple-200 border-2 border-purple-300 rounded-lg p-4 text-left w-full';
            btn.innerHTML = `<div class="font-semibold">${opt.text}</div><div class="text-sm text-gray-600 mt-1">Usando: "${opt.idiom}"</div>`;
            btn.onclick = () => answerScenario(index);
            optionsContainer.appendChild(btn);
        });
    }

    function answerScenario(selectedIndex) {
        const s = gameData.gameState;
        if (s.currentS >= s.scenarios.length) return;
        const scenario = s.scenarios[s.currentS];
        if (scenario.options[selectedIndex].correct) {
            s.score += 75;
            s.correctAnswers++;
        }
        document.getElementById('currentScore').textContent = s.score;
        s.currentS++;
        if (s.currentS >= s.scenarios.length) {
            const oldScore = gameData.zoneScores[4];
            gameData.zoneScores[4] = s.score;
            gameData.totalScore = gameData.totalScore - oldScore + s.score;
            showResults(5, s.score, s.correctAnswers, s.scenarios.length);
        } else {
            showScenario();
        }
    }

    function showResults(zone, score, correct, total, gameOver = false) {
        const modal = document.getElementById('resultsModal');
        const percentage = total > 0 ? Math.round((correct / total) * 100) : 0;
        
        document.getElementById('resultsScore').innerText = `${score} P`;
        
        if (gameOver) {
            document.getElementById('resultsIcon').innerText = 'üíî';
            document.getElementById('resultsTitle').innerText = '¬°Juego Terminado!';
            document.getElementById('resultsMessage').innerText = `Te quedaste sin vidas. ¬°Int√©ntalo de nuevo!`;
        } else if (percentage >= 80) {
            document.getElementById('resultsIcon').innerText = 'üéâ';
            document.getElementById('resultsTitle').innerText = '¬°Excelente!';
            document.getElementById('resultsMessage').innerText = `Obtuviste ${correct} de ${total} aciertos (${percentage}%)`;
        } else if (percentage >= 50) {
            document.getElementById('resultsIcon').innerText = 'üëç';
            document.getElementById('resultsTitle').innerText = '¬°Buen Trabajo!';
            document.getElementById('resultsMessage').innerText = `Obtuviste ${correct} de ${total} aciertos (${percentage}%)`;
        } else {
            document.getElementById('resultsIcon').innerText = 'üí™';
            document.getElementById('resultsTitle').innerText = '¬°Sigue Intentando!';
            document.getElementById('resultsMessage').innerText = `Obtuviste ${correct} de ${total} aciertos (${percentage}%)`;
        }
        
        modal.classList.remove('hidden');
    }
    
    document.addEventListener('DOMContentLoaded', updateDisplay);

  </script>
</body>
</html>