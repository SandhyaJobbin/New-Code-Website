<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>üå¥ Aventura en la Isla de Modismos</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&family=Inter:wght@400;500;600;700&display=swap');
    .game-font { font-family: 'Fredoka One', cursive; }
    .body-font { font-family: 'Inter', sans-serif; }
    .island-bg { background: linear-gradient(135deg,#667eea 0%,#764ba2 100%); min-height:100vh; }
    .zone-card { transition:.3s; }
    .zone-card:hover { transform:translateY(-5px); box-shadow:0 20px 40px rgba(0,0,0,0.1); }
    .zone-locked { opacity:.6; filter:grayscale(100%); }
    .progress-bar { transition:width .5s; }
    .drag-item { cursor:grab; transition:.2s; }
    .drag-item:hover { transform:scale(1.05); }
    .drop-zone { min-height:60px; transition:.2s; }
    .drop-zone.drag-over { background:#e0f2fe; border-color:#0284c7; }
    .correct-match { background:#dcfce7!important; border-color:#16a34a!important; }
    .wrong-match { background:#fef2f2!important; border-color:#dc2626!important; }
    @keyframes pulse {0%,100%{opacity:1}50%{opacity:.5}}
    .timer-warning { animation:pulse 1s infinite; }
  </style>
</head>
<body class="island-bg body-font text-gray-800">
  <div id="app" class="min-h-screen">
    <!-- MEN√ö PRINCIPAL -->
    <div id="mainMenu" class="container mx-auto px-4 py-8">
      <div class="text-center mb-12">
        <h1 class="game-font text-6xl text-white mb-4">üèùÔ∏è Aventura en la Isla de Modismos</h1>
        <p class="text-xl text-blue-100 mb-8">Domina 50 modismos espa√±oles con desaf√≠os emocionantes</p>
        <div class="bg-white/20 backdrop-blur-sm rounded-2xl p-6 max-w-md mx-auto mb-8">
          <div class="flex justify-between items-center mb-4">
            <span class="text-white font-semibold">Puntuaci√≥n total:</span>
            <span id="totalScore" class="text-2xl font-bold text-yellow-300">0</span>
          </div>
          <div class="w-full bg-white/20 rounded-full h-3">
            <div id="overallProgress" class="progress-bar bg-gradient-to-r from-yellow-400 to-orange-500 h-3 rounded-full" style="width:0%"></div>
          </div>
          <p class="text-blue-100 text-sm mt-2">Progreso hacia Maestro de Modismos</p>
        </div>
      </div>
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-6xl mx-auto">
        <!-- ZONA 1 -->
        <div class="zone-card bg-white rounded-2xl p-6 shadow-xl" data-zone="1">
          <div class="text-center">
            <div class="text-4xl mb-4">üèñÔ∏è</div>
            <h3 class="game-font text-2xl text-blue-600 mb-2">Bah√≠a de Emparejamientos</h3>
            <p class="text-gray-600 mb-4">Emparejar modismos con sus significados</p>
            <div class="flex justify-between text-sm text-gray-500 mb-4">
              <span>M√°x: 100 pts</span>
              <span id="zone1Score">Pts: 0</span>
            </div>
            <button onclick="startZone(1)" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-full font-semibold">Iniciar</button>
          </div>
        </div>
        <!-- ZONA 2 -->
        <div class="zone-card bg-white rounded-2xl p-6 shadow-xl zone-locked" data-zone="2">
          <div class="text-center">
            <div class="text-4xl mb-4">‚õ∞Ô∏è</div>
            <h3 class="game-font text-2xl text-gray-400 mb-2">Acantilados del Desaf√≠o</h3>
            <p class="text-gray-400 mb-4">Verdadero o Falso</p>
            <div class="flex justify-between text-sm text-gray-400 mb-4">
              <span>M√°x: 100 pts</span>
              <span id="zone2Score">Pts: 0</span>
            </div>
            <button class="bg-gray-300 text-gray-500 px-6 py-2 rounded-full cursor-not-allowed">üîí Bloqueado</button>
          </div>
        </div>
        <!-- ZONA 3 -->
        <div class="zone-card bg-white rounded-2xl p-6 shadow-xl zone-locked" data-zone="3">
          <div class="text-center">
            <div class="text-4xl mb-4">üíé</div>
            <h3 class="game-font text-2xl text-gray-400 mb-2">Cofre del Tesoro</h3>
            <p class="text-gray-400 mb-4">Rellenar espacios en frases</p>
            <div class="flex justify-between text-sm text-gray-400 mb-4">
              <span>M√°x: 150 pts</span>
              <span id="zone3Score">Pts: 0</span>
            </div>
            <button class="bg-gray-300 text-gray-500 px-6 py-2 rounded-full cursor-not-allowed">üîí Bloqueado</button>
          </div>
        </div>
        <!-- ZONA 4 -->
        <div class="zone-card bg-white rounded-2xl p-6 shadow-xl zone-locked" data-zone="4">
          <div class="text-center">
            <div class="text-4xl mb-4">‚ö°</div>
            <h3 class="game-font text-2xl text-gray-400 mb-2">Laguna Rel√°mpago</h3>
            <p class="text-gray-400 mb-4">Quiz r√°pido</p>
            <div class="flex justify-between text-sm text-gray-400 mb-4">
              <span>M√°x: 100 pts</span>
              <span id="zone4Score">Pts: 0</span>
            </div>
            <button class="bg-gray-300 text-gray-500 px-6 py-2 rounded-full cursor-not-allowed">üîí Bloqueado</button>
          </div>
        </div>
        <!-- ZONA 5 -->
        <div class="zone-card bg-white rounded-2xl p-6 shadow-xl zone-locked" data-zone="5">
          <div class="text-center">
            <div class="text-4xl mb-4">üåÄ</div>
            <h3 class="game-font text-2xl text-gray-400 mb-2">Laberinto de Modismos</h3>
            <p class="text-gray-400 mb-4">Retos de escenarios</p>
            <div class="flex justify-between text-sm text-gray-400 mb-4">
              <span>M√°x: 150 pts</span>
              <span id="zone5Score">Pts: 0</span>
            </div>
            <button class="bg-gray-300 text-gray-500 px-6 py-2 rounded-full cursor-not-allowed">üîí Bloqueado</button>
          </div>
        </div>
        <!-- RANGO -->
        <div class="zone-card bg-gradient-to-br from-yellow-400 to-orange-500 rounded-2xl p-6 shadow-xl">
          <div class="text-center text-white">
            <div class="text-4xl mb-4">üèÜ</div>
            <h3 class="game-font text-2xl mb-2">Tu Rango</h3>
            <p id="playerRank" class="text-lg font-semibold mb-2">Sigue practicando</p>
            <div class="text-sm opacity-90">
              <div>üèÜ 500+ pts: Campe√≥n</div>
              <div>üß≠ 400+ pts: Explorador</div>
              <div>üí° 0+ pts: Practicante</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- PANTALLA DE JUEGO -->
    <div id="gameScreen" class="hidden container mx-auto px-4 py-8">
      <div class="bg-white/20 backdrop-blur-sm rounded-2xl p-4 mb-6 flex justify-between items-center">
        <button onclick="returnToMenu()" class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg">‚Üê Volver</button>
        <div class="text-center">
          <h2 id="zoneTitle" class="game-font text-2xl text-white"></h2>
          <p id="zoneDescription" class="text-blue-100"></p>
        </div>
        <div class="text-right">
          <div class="text-white font-semibold">Puntos: <span id="currentScore">0</span></div>
          <div id="timerDisplay" class="text-yellow-300 font-bold hidden"></div>
        </div>
      </div>
      <!-- Zona 1 -->
      <div id="zone1Game" class="hidden bg-white rounded-2xl p-6 shadow-xl">
        <div class="mb-6">
          <div class="flex justify-between items-center mb-2">
            <span class="font-semibold">Progreso</span>
            <span id="matchProgress">0/10</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-3">
            <div id="matchProgressBar" class="progress-bar bg-blue-500 h-3 rounded-full" style="width:0%"></div>
          </div>
        </div>
        <div class="grid md:grid-cols-2 gap-8">
          <div>
            <h3 class="font-bold text-lg text-center mb-4">Modismos</h3>
            <div id="idiomsColumn" class="space-y-3"></div>
          </div>
          <div>
            <h3 class="font-bold text-lg text-center mb-4">Significados</h3>
            <div id="meaningsColumn" class="space-y-3"></div>
          </div>
        </div>
        <div class="text-center mt-6">
          <button id="checkMatches" onclick="checkMatches()" class="bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-full font-semibold">Comprobar</button>
        </div>
      </div>
      <!-- Zona 2 -->
      <div id="zone2Game" class="hidden bg-white rounded-2xl p-6 shadow-xl max-w-2xl mx-auto">
        <div class="mb-6">
          <div class="flex justify-between items-center mb-2">
            <span class="font-semibold">Pregunta <span id="tfQuestionNum">1</span>/10</span>
            <span class="text-red-500 font-semibold">Vidas: <span id="livesCount">3</span> ‚ù§Ô∏è</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-3">
            <div id="tfProgressBar" class="progress-bar bg-purple-500 h-3 rounded-full" style="width:10%"></div>
          </div>
        </div>
        <div class="text-center mb-8">
          <div class="bg-blue-50 rounded-xl p-6 mb-6">
            <h3 id="tfIdiom" class="text-2xl font-bold text-blue-600 mb-4"></h3>
            <p id="tfDefinition" class="text-lg text-gray-700"></p>
          </div>
          <div class="space-x-4">
            <button onclick="answerTrueFalse(true)" class="bg-green-500 hover:bg-green-600 text-white px-8 py-4 rounded-full font-bold text-xl">‚úì VERDADERO</button>
            <button onclick="answerTrueFalse(false)" class="bg-red-500 hover:bg-red-600 text-white px-8 py-4 rounded-full font-bold text-xl">‚úó FALSO</button>
          </div>
        </div>
      </div>
      <!-- Zona 3 -->
      <div id="zone3Game" class="hidden bg-white rounded-2xl p-6 shadow-xl max-w-2xl mx-auto">
        <div class="mb-6">
          <div class="flex justify-between items-center mb-2">
            <span class="font-semibold">Pregunta <span id="fibQuestionNum">1</span>/10</span>
            <span class="font-semibold">Bonus üìù</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-3">
            <div id="fibProgressBar" class="progress-bar bg-green-500 h-3 rounded-full" style="width:10%"></div>
          </div>
        </div>
        <div class="text-center mb-8">
          <div class="bg-green-50 rounded-xl p-6 mb-6">
            <p id="fibSentence" class="text-lg text-gray-700 mb-4"></p>
            <select id="fibSelect" class="border-2 border-green-300 rounded-lg px-4 py-2 text-lg bg-white">
              <option value="">Selecciona un modismo‚Ä¶</option>
            </select>
          </div>
          <button onclick="submitFillBlank()" class="bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-full font-semibold mb-4">Enviar</button>
          <div class="border-t pt-4">
            <p class="text-sm text-gray-600 mb-2">Bonus: Escribe tu propia frase</p>
            <textarea id="bonusSentence" class="w-full border-2 border-gray-300 rounded-lg p-3 text-sm" placeholder="Tu frase‚Ä¶"></textarea>
            <button onclick="submitBonus()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg font-semibold mt-2">Bonus +5 pts</button>
          </div>
        </div>
      </div>
      <!-- Zona 4 -->
      <div id="zone4Game" class="hidden bg-white rounded-2xl p-6 shadow-xl max-w-2xl mx-auto">
        <div class="mb-6">
          <div class="flex justify-between items-center mb-2">
            <span class="font-semibold">Pregunta <span id="lrQuestionNum">1</span>/20</span>
            <span id="lrTimer" class="text-2xl font-bold text-red-500">60</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-3">
            <div id="lrProgressBar" class="progress-bar bg-yellow-500 h-3 rounded-full" style="width:5%"></div>
          </div>
        </div>
        <div class="text-center mb-8">
          <div class="bg-yellow-50 rounded-xl p-6 mb-6">
            <h3 id="lrIdiom" class="text-2xl font-bold text-yellow-600 mb-4"></h3>
          </div>
          <div id="lrOptions" class="grid grid-cols-2 gap-4"></div>
        </div>
      </div>
      <!-- Zona 5 -->
      <div id="zone5Game" class="hidden bg-white rounded-2xl p-6 shadow-xl max-w-3xl mx-auto">
        <div class="mb-6">
          <div class="flex justify-between items-center mb-2">
            <span class="font-semibold">Escenario <span id="scenarioNum">1</span>/8</span>
            <span class="font-semibold">Desaf√≠o Final üåü</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-3">
            <div id="scenarioProgressBar" class="progress-bar bg-purple-500 h-3 rounded-full" style="width:12.5%"></div>
          </div>
        </div>
        <div class="mb-8">
          <div class="bg-purple-50 rounded-xl p-6 mb-6">
            <h3 id="scenarioTitle" class="text-xl font-bold text-purple-600 mb-4"></h3>
            <p id="scenarioDescription" class="text-gray-700 mb-4"></p>
            <p id="scenarioQuestion" class="font-semibold text-gray-800"></p>
          </div>
          <div id="scenarioOptions" class="space-y-3"></div>
        </div>
      </div>
    </div>

    <!-- Modal de Resultados -->
    <div id="resultsModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
      <div class="bg-white rounded-2xl p-8 max-w-md mx-4 text-center">
        <div id="resultsIcon" class="text-6xl mb-4"></div>
        <h3 id="resultsTitle" class="game-font text-2xl mb-4"></h3>
        <p id="resultsMessage" class="text-gray-600 mb-6"></p>
        <div id="resultsScore" class="text-3xl font-bold text-blue-600 mb-6"></div>
        <button onclick="closeResults()" class="bg-blue-500 hover:bg-blue-600 text-white px-8 py-3 rounded-full font-semibold">Continuar</button>
      </div>
    </div>
  </div>

  <script>
    const gameData={ totalScore:0,zoneScores:[0,0,0,0,0],unlockedZones:[true,false,false,false,false],currentZone:0,gameState:{} };

    const idiomsData={
      zone1:[
        {idiom:"Dar en el clavo",meaning:"Acertar exactamente"},
        {idiom:"Estar en las nubes",meaning:"Distra√≠do, despistado"},
        {idiom:"Ser pan comido",meaning:"Muy f√°cil"},
        {idiom:"Estar entre la espada y la pared",meaning:"Situaci√≥n l√≠mite"},
        {idiom:"No dar pie con bola",meaning:"Equivocarse continuamente"},
        {idiom:"Tirar la casa por la ventana",meaning:"Gastar mucho dinero"},
        {idiom:"Meter la pata",meaning:"Cometer un fallo"},
        {idiom:"Echar una mano",meaning:"Ayudar"},
        {idiom:"Quedarse de piedra",meaning:"Sorprenderse mucho"},
        {idiom:"Hacer la vista gorda",meaning:"Ignorar voluntariamente"}
      ],
      zone2:[
        {idiom:"No hay tut√≠a",meaning:"No hay remedio",correct:true},
        {idiom:"Ahogarse en un vaso de agua",meaning:"Rendirse en cosas peque√±as",correct:true},
        {idiom:"Hacer o√≠dos sordos",meaning:"Ignorar algo deliberadamente",correct:true},
        {idiom:"Poner la mano en el fuego",meaning:"Arriesgarse sin dudar",correct:false},
        {idiom:"Pasarse de la raya",meaning:"Excederse",correct:true},
        {idiom:"Ser un cero a la izquierda",meaning:"Ser insignificante",correct:true},
        {idiom:"Estar como una cabra",meaning:"Estar loco",correct:true},
        {idiom:"Dormir a pierna suelta",meaning:"Dormir profundamente",correct:true},
        {idiom:"Tener mala leche",meaning:"Ser mal car√°cter",correct:true},
        {idiom:"Buscar tres pies al gato",meaning:"Complicar sin necesidad",correct:true}
      ],
      zone3:[
        {sentence:"Tengo que _______ y asumir las consecuencias.",answer:"tragarse el orgullo",options:["tragarse el orgullo","dar la lata","poner los puntos sobre las √≠es","salir de Guatemala"]},
        {sentence:"No conviene _______ antes de tiempo.",answer:"cantar victoria antes de tiempo",options:["cantar victoria antes de tiempo","pegar sambenitos","andar con pies de plomo","sacar de quicio"]},
        {sentence:"Esta tarea me va a _______ pero la consigo.",answer:"costar un ojo de la cara",options:["costar un ojo de la cara","salir rana","ser pan comido","meter baza"]},
        {sentence:"Despu√©s de tanto esfuerzo, merecemos _______ por hoy.",answer:"dar por terminado",options:["dar por terminado","dormirse en los laureles","echar un cable","poner al mal tiempo buena cara"]},
        {sentence:"No _______ y d√≠melo de una vez.",answer:"andarse por las ramas",options:["andarse por las ramas","comerse la cabeza","poner el dedo en la llaga","dar la nota"]},
        {sentence:"El despido fue _______ porque encontr√© algo mejor.",answer:"un mal necesario",options:["un mal necesario","agua de mayo","piedra de toque","clavo ardiendo"]},
        {sentence:"Creo que _______ con este proyecto.",answer:"me he metido en camisa de once varas",options:["me he metido en camisa de once varas","pongo mi granito de arena","veo la paja en el ojo ajeno","andar de capa ca√≠da"]},
        {sentence:"_______ ‚Äì al menos apareciste.",answer:"m√°s vale tarde que nunca",options:["m√°s vale tarde que nunca","hacer la pelota","partir la pana","devolver gentilezas"]},
        {sentence:"A partir de ahora _______ ‚Äì t√∫ decides qu√© hacer.",answer:"el bal√≥n est√° en tu tejado",options:["el bal√≥n est√° en tu tejado","salir por peteneras","romper lanzas","velar armas"]},
        {sentence:"Basta de _______ ‚Äì lo pasado, pisado.",answer:"llorar sobre la leche derramada",options:["llorar sobre la leche derramada","perder el norte","meter la cuchara","hacer la pelota"]}
      ],
      zone4:[
        {idiom:"Dar en el clavo",options:["Acertar","Fallar","Dudar","Ignorar"],answer:0},
        {idiom:"Ser pan comido",options:["Muy f√°cil","Muy caro","Dif√≠cil","Raro"],answer:0},
        {idiom:"Dormir a pierna suelta",options:["Dormir profundo","Despertar","Levantarse","Correr"],answer:0},
        {idiom:"Meter la pata",options:["Fallar","Acertar","Correr","Dormir"],answer:0},
        {idiom:"Tirar la casa por la ventana",options:["Gastar mucho","Ahorrar","Dormir","Cocinar"],answer:0},
        {idiom:"Quedarse de piedra",options:["Sorprenderse","Romper","Comer","Dormir"],answer:0},
        {idiom:"No dar pie con bola",options:["Equivocarse","Acertar","Dormir","Romper"],answer:0},
        {idiom:"Hacer o√≠dos sordos",options:["Ignorar","Escuchar","O√≠r","Hablar"],answer:0},
        {idiom:"Andarse por las ramas",options:["No ir al grano","Ir al grano","Correr","Dormir"],answer:0},
        {idiom:"M√°s vale tarde que nunca",options:["Antes tarde","Nunca tarde","Corre","Vuela"],answer:0},
        {idiom:"Echar una mano",options:["Ayudar","Ignorar","Cocinar","Romper"],answer:0},
        {idiom:"Poner la mano en el fuego",options:["Arriesgarse","Ignorar","Dormir","Romper"],answer:0},
        {idiom:"Ahogarse en un vaso de agua",options:["Rendirse","Luchar","Dormir","Correr"],answer:0},
        {idiom:"Tener mala leche",options:["Ser amargado","Ser bueno","Dormir","Romper"],answer:0},
        {idiom:"Ser un cero a la izquierda",options:["Insignificante","Importante","Dormir","Correr"],answer:0},
        {idiom:"Buscar tres pies al gato",options:["Complicar","Facilitar","Dormir","Cocinar"],answer:0},
        {idiom:"Pasarse de la raya",options:["Excederse","Ceder","Dormir","Correr"],answer:0},
        {idiom:"No hay tut√≠a",options:["No hay remedio","Hay remedio","Dormir","Romper"],answer:0},
        {idiom:"M√°s loco que una cabra",options:["Muy loco","Muy cuerdo","Dormir","Correr"],answer:0},
        {idiom:"Dormir a pierna suelta",options:["Dormir profundo","Despertar","Levantarse","Correr"],answer:0}
      ],
      zone5:[
        {
          title:"Crisis de entrega en la oficina",
          description:"El equipo fall√≥ una fecha l√≠mite importante.",
          question:"¬øQu√© le dices al jefe?",
          options:[
            {text:"Tenemos que tragarnos el orgullo y asumir responsabilidad.",idiom:"tragarse el orgullo",correct:true},
            {text:"Voy a tirar la casa por la ventana y olvidarnos.",idiom:"tirar la casa por la ventana",correct:false},
            {text:"No hay tut√≠a, est√° todo perdido.",idiom:"no hay tut√≠a",correct:false},
            {text:"Es pan comido, lo soluciono r√°pido.",idiom:"ser pan comido",correct:false}
          ]
        },
        {
          title:"Entrevista de trabajo",
          description:"Est√°s nervioso y no sabes c√≥mo empezar.",
          question:"¬øC√≥mo rompes el hielo?",
          options:[
            {text:"Intentar√© no andar por las ramas y ser directo.",idiom:"andarse por las ramas",correct:true},
            {text:"Voy a dar la lata con chistes malos.",idiom:"dar la lata",correct:false},
            {text:"Me quedo de piedra y no hablo.",idiom:"quedarse de piedra",correct:false},
            {text:"Har√© o√≠dos sordos a sus preguntas.",idiom:"hacer o√≠dos sordos",correct:false}
          ]
        },
        {
          title:"Decisi√≥n de compra cara",
          description:"Quieres comprar un coche muy caro.",
          question:"¬øQu√© te dices?",
          options:[
            {text:"Me va a costar un ojo de la cara, debo pensarlo bien.",idiom:"costar un ojo de la cara",correct:true},
            {text:"M√°s vale tarde que nunca, lo compro cuando pueda.",idiom:"m√°s vale tarde que nunca",correct:false},
            {text:"Es pan comido, me lo llevo ya.",idiom:"ser pan comido",correct:false},
            {text:"Meter√© la pata seguro.",idiom:"meter la pata",correct:false}
          ]
        },
        {
          title:"Secreto de un amigo",
          description:"Un amigo te confi√≥ algo privado.",
          question:"¬øQu√© haces?",
          options:[
            {text:"Hago o√≠dos sordos a las preguntas ajenas.",idiom:"hacer o√≠dos sordos",correct:true},
            {text:"Lo cuento todo, no hay tut√≠a.",idiom:"no hay tut√≠a",correct:false},
            {text:"Tirar√© la casa por la ventana y lo har√© p√∫blico.",idiom:"tirar la casa por la ventana",correct:false},
            {text:"Me quedo de piedra y no digo nada.",idiom:"quedarse de piedra",correct:false}
          ]
        },
        {
          title:"Sobrecarga de trabajo",
          description:"Tienes demasiadas tareas acumuladas.",
          question:"¬øQu√© reconoces?",
          options:[
            {text:"Me he metido en camisa de once varas, necesito ayuda.",idiom:"camisa de once varas",correct:true},
            {text:"Ser√° pan comido, lo arreglo solo.",idiom:"ser pan comido",correct:false},
            {text:"Voy a dormir a pierna suelta.",idiom:"dormir a pierna suelta",correct:false},
            {text:"No dar√© pie con bola y lo dejo.",idiom:"no dar pie con bola",correct:false}
          ]
        },
        {
          title:"Decisi√≥n en equipo",
          description:"El equipo espera tu decisi√≥n.",
          question:"¬øQu√© dices?",
          options:[
            {text:"El bal√≥n est√° en mi tejado, decido yo.",idiom:"bal√≥n en mi tejado",correct:true},
            {text:"Tiro la casa por la ventana con esta decisi√≥n.",idiom:"tirar la casa por la ventana",correct:false},
            {text:"Andar√© por las ramas y no decidir√©.",idiom:"andarse por las ramas",correct:false},
            {text:"No hay tut√≠a, decidan otros.",idiom:"no hay tut√≠a",correct:false}
          ]
        },
        {
          title:"Fracaso de proyecto",
          description:"Un proyecto importante fracas√≥.",
          question:"¬øC√≥mo lo valoras?",
          options:[
            {text:"Fue un mal necesario para aprender.",idiom:"mal necesario",correct:true},
            {text:"Lloro sobre la leche derramada.",idiom:"llorar sobre la leche derramada",correct:false},
            {text:"Meter√© la pata con el siguiente.",idiom:"meter la pata",correct:false},
            {text:"Quedo de piedra y no digo nada.",idiom:"quedarse de piedra",correct:false}
          ]
        },
        {
          title:"Fin de jornada laboral",
          description:"Tras 12 horas, est√°s agotado.",
          question:"¬øQu√© propones?",
          options:[
            {text:"Es hora de dar por terminado y descansar.",idiom:"dar por terminado",correct:true},
            {text:"Voy a dormir a pierna suelta en la oficina.",idiom:"dormir a pierna suelta",correct:false},
            {text:"Ser√° pan comido seguir trabajando.",idiom:"ser pan comido",correct:false},
            {text:"Andar√© por las ramas y no trabajar√© m√°s.",idiom:"andarse por las ramas",correct:false}
          ]
        }
      ]
    };

    function initGame(){ updateDisplay(); }
    function updateDisplay(){
      document.getElementById('totalScore').textContent=gameData.totalScore;
      document.getElementById('overallProgress').style.width=`${Math.min(gameData.totalScore/600*100,100)}%`;
      for(let i=0;i<5;i++){
        document.getElementById(`zone${i+1}Score`).textContent=`Pts: ${gameData.zoneScores[i]}`;
        const c=document.querySelector(`[data-zone="${i+1}"]`),b=c.querySelector('button');
        if(gameData.unlockedZones[i]){
          c.classList.remove('zone-locked');
          b.className='bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-full font-semibold';
          b.textContent=gameData.zoneScores[i]>0?'Reintentar':'Iniciar';
          b.onclick=()=>startZone(i+1);
        }
      }
      const r=document.getElementById('playerRank');
      if(gameData.totalScore>=500) r.textContent='Campe√≥n üèÜ';
      else if(gameData.totalScore>=400) r.textContent='Explorador üß≠';
      else r.textContent='Sigue practicando üí°';
    }

    function startZone(z){
      gameData.currentZone=z;
      document.getElementById('mainMenu').classList.add('hidden');
      document.getElementById('gameScreen').classList.remove('hidden');
      for(let i=1;i<=5;i++)document.getElementById(`zone${i}Game`).classList.add('hidden');
      document.getElementById(`zone${z}Game`).classList.remove('hidden');
      const zoneInfo={
        1:{title:'üèñÔ∏è Bah√≠a de Emparejamientos',desc:'Emparejar modismos con sus significados'},
        2:{title:'‚õ∞Ô∏è Acantilados del Desaf√≠o',desc:'Verdadero o Falso'},
        3:{title:'üíé Cofre del Tesoro',desc:'Rellenar espacios en frases'},
        4:{title:'‚ö° Laguna Rel√°mpago',desc:'Quiz r√°pido'},
        5:{title:'üåÄ Laberinto de Modismos',desc:'Retos de escenarios'}
      };
      document.getElementById('zoneTitle').textContent=zoneInfo[z].title;
      document.getElementById('zoneDescription').textContent=zoneInfo[z].desc;
      document.getElementById('currentScore').textContent='0';
      if(z===1) initZone1();
      if(z===2) initZone2();
      if(z===3) initZone3();
      if(z===4) initZone4();
      if(z===5) initZone5();
    }

    // Zona1: Arrastrar y Soltar
    function initZone1(){
      const idioms=[...idiomsData.zone1],meanings=[...idioms.map(x=>x.meaning)];
      for(let i=meanings.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [meanings[i],meanings[j]]=[meanings[j],meanings[i]];
      }
      gameData.gameState={idioms,meanings,matches:{}};
      renderMatchingGame();
    }
    function renderMatchingGame(){
      const col1=document.getElementById('idiomsColumn'),col2=document.getElementById('meaningsColumn');
      col1.innerHTML='';col2.innerHTML='';
      gameData.gameState.idioms.forEach(item=>{
        const d=document.createElement('div');
        d.className='drag-item bg-blue-100 border-2 border-blue-300 rounded-lg p-3 text-center font-semibold';
        d.draggable=true;d.textContent=item.idiom;d.dataset.idiom=item.idiom;
        d.addEventListener('dragstart',e=>e.dataTransfer.setData('text',e.target.dataset.idiom));
        col1.appendChild(d);
      });
      gameData.gameState.meanings.forEach(m=>{
        const d=document.createElement('div');
        d.className='drop-zone bg-gray-50 border-2 border-gray-300 rounded-lg p-3 flex items-center justify-center';
        d.dataset.meaning=m;d.textContent=m;
        d.addEventListener('dragover',e=>{e.preventDefault();d.classList.add('drag-over');});
        d.addEventListener('drop',e=>{
          e.preventDefault();d.classList.remove('drag-over');
          const idiom=e.dataTransfer.getData('text');
          gameData.gameState.matches[idiom]=m;
          d.innerHTML=`<div class="font-semibold text-blue-600">${idiom}</div><div class="text-sm text-gray-600">${m}</div>`;
          d.classList.add('bg-blue-50','border-blue-400');
          document.querySelector(`[data-idiom="${idiom}"]`).style.opacity='0.3';
          updateMatchProgress();
        });
        col2.appendChild(d);
      });
    }
    function updateMatchProgress(){
      const c=Object.keys(gameData.gameState.matches).length;
      document.getElementById('matchProgress').textContent=`${c}/10`;
      document.getElementById('matchProgressBar').style.width=`${c*10}%`;
    }
    function checkMatches(){
      let correct=0;
      gameData.gameState.idioms.forEach(item=>{
        if(gameData.gameState.matches[item.idiom]===item.meaning){
          correct++;document.querySelector(`[data-meaning="${item.meaning}"]`).classList.add('correct-match');
        } else {
          const m=gameData.gameState.matches[item.idiom];
          if(m)document.querySelector(`[data-meaning="${m}"]`).classList.add('wrong-match');
        }
      });
      const score=correct*10;
      gameData.zoneScores[0]=score;gameData.totalScore+=score;
      if(correct>=8) gameData.unlockedZones[1]=true;
      showResults(1,score,correct,10);
    }

    // Zona2: Verdadero/Falso
    function initZone2(){
      gameData.gameState={questions:[...idiomsData.zone2],currentQ:0,score:0,lives:3,correct:0};
      showTrueFalseQuestion();
    }
    function showTrueFalseQuestion(){
      const s=gameData.gameState,q=s.questions[s.currentQ];
      document.getElementById('tfQuestionNum').textContent=s.currentQ+1;
      document.getElementById('livesCount').textContent=s.lives;
      document.getElementById('tfIdiom').textContent=q.idiom;
      document.getElementById('tfDefinition').textContent=q.meaning;
      document.getElementById('tfProgressBar').style.width=`${(s.currentQ+1)*10}%`;
    }
    function answerTrueFalse(ans){
      const s=gameData.gameState,q=s.questions[s.currentQ];
      if(ans===q.correct){s.score+=5;s.correct++;} else{s.lives--;s.score=Math.max(0,s.score-2);}
      document.getElementById('currentScore').textContent=s.score;
      if(s.lives<=0){s.currentQ=0;s.lives=3;s.score=0;showTrueFalseQuestion();return;}
      s.currentQ++;
      if(s.currentQ>=s.questions.length){
        gameData.zoneScores[1]=s.score;gameData.totalScore+=s.score;gameData.unlockedZones[2]=true;
        showResults(2,s.score,s.correct,s.questions.length);
      } else setTimeout(showTrueFalseQuestion,500);
    }

    // Zona3: Rellenar
    function initZone3(){
      gameData.gameState={questions:[...idiomsData.zone3],currentQ:0,score:0,correct:0};
      showFillBlankQuestion();
    }
    function showFillBlankQuestion(){
      const s=gameData.gameState,q=s.questions[s.currentQ];
      document.getElementById('fibQuestionNum').textContent=s.currentQ+1;
      document.getElementById('fibSentence').textContent=q.sentence;
      document.getElementById('fibProgressBar').style.width=`${(s.currentQ+1)*10}%`;
      const sel=document.getElementById('fibSelect');sel.innerHTML='<option value="">Selecciona‚Ä¶</option>';
      q.options.forEach(o=>sel.innerHTML+=`<option value="${o}">${o}</option>`);
      document.getElementById('bonusSentence').value='';
    }
    function submitFillBlank(){
      const s=gameData.gameState,q=s.questions[s.currentQ],ans=document.getElementById('fibSelect').value;
      if(!ans){alert('Selecciona un modismo');return;}
      if(ans===q.answer){s.score+=15;s.correct++;}
      document.getElementById('currentScore').textContent=s.score;
      s.currentQ++;
      if(s.currentQ>=s.questions.length){
        gameData.zoneScores[2]=s.score;gameData.totalScore+=s.score;gameData.unlockedZones[3]=true;
        showResults(3,s.score,s.correct,s.questions.length);
      } else setTimeout(showFillBlankQuestion,500);
    }
    function submitBonus(){
      const t=document.getElementById('bonusSentence').value.trim();
      if(t.length>10){gameData.gameState.score+=5;document.getElementById('currentScore').textContent=gameData.gameState.score;alert('Bonus +5 pts');document.getElementById('bonusSentence').value='';}
      else alert('Escribe m√°s para el bonus');
    }

    // Zona4: Quiz r√°pido
    function initZone4(){
      gameData.gameState={questions:[...idiomsData.zone4],currentQ:0,score:0,timeLeft:60,correct:0};
      startTimer();showLightningQuestion();
    }
    function startTimer(){
      document.getElementById('timerDisplay').classList.remove('hidden');
      gameData.gameState.timer=setInterval(()=>{
        const s=gameData.gameState;s.timeLeft--;document.getElementById('lrTimer').textContent=s.timeLeft;
        if(s.timeLeft<=10)document.getElementById('lrTimer').classList.add('timer-warning');
        if(s.timeLeft<=0){clearInterval(s.timer);finishLQ();}
      },1000);
    }
    function showLightningQuestion(){
      const s=gameData.gameState,q=s.questions[s.currentQ];
      document.getElementById('lrQuestionNum').textContent=s.currentQ+1;
      document.getElementById('lrIdiom').textContent=q.idiom;
      document.getElementById('lrProgressBar').style.width=`${(s.currentQ+1)*5}%`;
      const c=document.getElementById('lrOptions');c.innerHTML='';
      q.options.forEach((o,i)=>c.innerHTML+=`<button class="bg-yellow-100 hover:bg-yellow-200 border-2 border-yellow-300 rounded-lg p-4 w-full text-left font-semibold" onclick="answerLQ(${i})">${o}</button>`);
    }
    function answerLQ(i){
      const s=gameData.gameState,q=s.questions[s.currentQ];
      if(i===q.answer){s.score+=5+s.timeLeft;s.correct++;}
      document.getElementById('currentScore').textContent=s.score;
      s.currentQ++;if(s.currentQ>=s.questions.length||s.timeLeft<=0)finishLQ();else showLightningQuestion();
    }
    function finishLQ(){
      const s=gameData.gameState;clearInterval(s.timer);document.getElementById('timerDisplay').classList.add('hidden');
      gameData.zoneScores[3]=s.score;gameData.totalScore+=s.score;gameData.unlockedZones[4]=true;showResults(4,s.score,s.correct,20);
    }

    // Zona5: Escenarios
    function initZone5(){
      gameData.gameState={scenarios:[...idiomsData.zone5],currentS:0,score:0,correct:0};
      showScenario();
    }
    function showScenario(){
      const s=gameData.gameState,sc=s.scenarios[s.currentS];
      document.getElementById('scenarioNum').textContent=s.currentS+1;
      document.getElementById('scenarioTitle').textContent=sc.title;
      document.getElementById('scenarioDescription').textContent=sc.description;
      document.getElementById('scenarioQuestion').textContent=sc.question;
      document.getElementById('scenarioProgressBar').style.width=`${(s.currentS+1)*12.5}%`;
      const c=document.getElementById('scenarioOptions');c.innerHTML='';
      sc.options.forEach((o,i)=>c.innerHTML+=`<button class="bg-purple-100 hover:bg-purple-200 border-2 border-purple-300 rounded-lg p-4 w-full text-left font-semibold" onclick="answerScenario(${i})"><div>${o.text}</div><div class="text-sm text-gray-600 mt-1">"${o.idiom}"</div></button>`);
    }
    function answerScenario(i){
      const s=gameData.gameState,sc=s.scenarios[s.currentS];
      if(sc.options[i].correct){s.score+=20;s.correct++;}
      document.getElementById('currentScore').textContent=s.score;
      s.currentS++;if(s.currentS>=s.scenarios.length){gameData.zoneScores[4]=s.score;gameData.totalScore+=s.score;showResults(5,s.score,s.correct,8);} else setTimeout(showScenario,800);
    }

    function showResults(z,score,correct,total){
      const pct=Math.round(correct/total*100);
      document.getElementById('resultsIcon').textContent=pct>=80?'üéâ':pct>=60?'üëç':'üí™';
      document.getElementById('resultsTitle').textContent=pct>=80?'¬°Excelente!':pct>=60?'¬°Bien hecho!':'¬°Sigue intent√°ndolo!';
      document.getElementById('resultsMessage').textContent=pct>=80?`Zona dominada con ${pct}% de aciertos!`:pct>=60?`${pct}% de aciertos. ¬°Sigue as√≠!`:`${pct}% de aciertos. ¬°Practica m√°s!`;
      document.getElementById('resultsScore').textContent=`+${score} pts`;
      document.getElementById('resultsModal').classList.remove('hidden');
    }
    function closeResults(){document.getElementById('resultsModal').classList.add('hidden');returnToMenu();}
    function returnToMenu(){document.getElementById('gameScreen').classList.add('hidden');document.getElementById('mainMenu').classList.remove('hidden');updateDisplay();}

    initGame();
  </script>
</body>
</html>
